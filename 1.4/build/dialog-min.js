/*! editorUploader - v1.4 - 2013-12-07 4:22:13 PM
* Copyright (c) 2013 minghe; Licensed  */
KISSY.add("gallery/editorUploader/1.4/dialog",function(a,b,c,d,e){function f(a,b){this.editor=a,this.config=b}var g=b.all;return a.augment(f,{hide:function(){this.dialog.hide()},show:function(){var a=this,b=a.dialog;if(!b){var c=new e(a.config.tpl).render({prefix:a.config.prefix||"editor-"});b=a.dialog=new d({width:610,mask:!0,headerContent:"\u6279\u91cf\u4e0a\u4f20",bodyContent:c}).render(),a._renderUploader()}b.show(),b.center()},_renderUploader:function(){var b=this,c=b.config;if(b.uploader)return!1;var d="#"+c.prefix+"uploader-button",e="."+c.prefix+"uploader-queue";a.use("gallery/uploader/1.5/aliUploader,gallery/uploader/1.5/plugins/auth/auth,gallery/uploader/1.5/plugins/proBars/proBars,gallery/uploader/1.5/themes/editorMultipleUploader/index,gallery/uploader/1.5/themes/editorMultipleUploader/style.css",function(a,f,h,i,j){var k=new f(d,c);b.uploader=k,k.theme(new j({queueTarget:e})),k.plug(new h(c.auth||{})).plug(new i({isHide:!1}));var l=g(e).parent().parent(".J_UploaderQueueWrapper"),m=l.all(".J_InsertContent");m.on("click",b._insertHandler,b),k.on("add",function(){"none"==l.css("display")&&l.fadeIn(.5)}),k.on("remove",function(){k.get("queue").get("files").length||l.fadeOut(.5)});var n=k.get("queue");g(".J_ClearQueue").on("click",function(a){a.preventDefault(),n.clear()}),g(".J_StartUpload").on("click",function(){k.uploadFiles("waiting")})})},_insertHandler:function(){var b=this,c=b.editor,d=c.get("document")[0],e=b.uploader,f=e.get("queue"),h=f.getFiles("success");if(!h.length)return alert("\u4e0d\u5b58\u5728\u6210\u529f\u4e0a\u4f20\u7684\u56fe\u7247\uff01"),!1;a.each(h,function(a){var b=a.result.url;(new Image).src=b,c.insertElement(g("<p>&nbsp;<img src='"+b+"'/>&nbsp;</p>",d)),f.remove(a.id)});var i=b.dialog;i.hide()}}),f},{requires:["node","editor","editor/plugin/dialog","xtemplate"]});