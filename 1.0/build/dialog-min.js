/*! editorUploader - v1.0 - 2013-05-19 5:43:16 PM
* Copyright (c) 2013 minghe; Licensed  */
KISSY.add("gallery/editorUploader/1.0/dialog",function(e,r,t,o,l,n,i,a,d){function u(e,r){this.editor=e,this.config=r,t.Utils.lazyRun(this,"_prepareShow","_realShow")}var s=r.all,p=l.Dialog;return e.augment(u,{addRes:t.Utils.addRes,destroy:t.Utils.destroyRes,show:function(){var e=this;e.editor,e.dialog||(e.dialog=new p({headerContent:"批量上传",prefixCls:"ks-editor-",mask:!1,plugins:[new o({handlers:[".ks-editor-stdmod-header"]})],focus4e:!1,width:"600px"}).render(),e.addRes(e.dialog),e._append());var r=e.dialog;r.show(),r.center(),e._renderUploader()},_append:function(){var e=this,r=e.dialog;if(!r)return e;var t=r.get("body"),o=e.config.tpl;return o?(t.html(o),e):e},_renderUploader:function(){var r=this,t=r.config;if(r.uploader)return!1;var o=new n(t.target,t);r.uploader=o,o.theme(new i({queueTarget:t.queueTarget})),o.plug(new a(t.auth||{})).plug(new d({isHide:!1}));var l=e.Node.all,u=l(".J_UploaderQueueWrapper"),s=l(".J_InsertContent");s.on("click",r._insertHandler,r),o.on("add",function(){"none"==u.css("display")&&u.fadeIn(.5)}),o.on("remove",function(){o.get("queue").get("files").length||u.fadeOut(.5)});var p=o.get("queue");l(".J_ClearQueue").on("click",function(e){e.preventDefault(),p.clear()}),l(".J_StartUpload").on("click",function(){o.uploadFiles("waiting")})},_insertHandler:function(){var r=this,t=r.editor,o=t.get("document")[0],l=r.uploader,n=l.get("queue"),i=n.getFiles("success");return i.length?(e.each(i,function(e){var r=e.result.url;(new Image).src=r,t.insertElement(s("<p>&nbsp;<img src='"+r+"'/>&nbsp;</p>",o)),n.remove(e.id)}),void 0):(alert("不存在成功上传的图片！"),!1)}}),u},{requires:["node","editor","component/plugin/drag","overlay","gallery/uploader/1.4/","gallery/uploader/1.4/themes/editorMultipleUploader/","gallery/uploader/1.4/plugins/auth/auth","gallery/uploader/1.4/plugins/proBars/proBars","gallery/uploader/1.4/themes/editorMultipleUploader/style.css"]});