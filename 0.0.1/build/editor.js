modulex.add("editor",["html-parser","ua","node","util","xtemplate/runtime","component/control","dom"],function(e,t,n){var r,o,a,i,s,d,l,c,u,f,m,p,v,E,T,N,h,_,g,y,O=e("html-parser"),S=e("ua"),b=e("node"),C=e("util"),k=e("xtemplate/runtime"),I=e("component/control"),R=e("dom");r=function(e){var t=e=function(e){{var t,n=this,r=n.root,o=n.buffer,a=n.scope,i=(n.runtime,n.name,n.pos),s=a.data,d=a.affix,l=r.nativeCommands,c=r.utils;c.callFn,c.callCommand,l.range,l.foreach,l.forin,l.each,l["with"],l["if"],l.set,l.include,l.parse,l.extend,l.block,l.macro,l["debugger"]}o.data+="<!doctype html>\r\n<html>\r\n<head>",i.line=3;var u=(t=d.doctype)!==e?t:(t=s.doctype)!==e?t:a.resolveLooseUp(["doctype"]);o=o.write(u),o.data+="\r\n    <title>",i.line=4;var f=(t=d.title)!==e?t:(t=s.title)!==e?t:a.resolveLooseUp(["title"]);o=o.write(f),o.data+="</title>\r\n    ",i.line=5;var m=(t=d.style)!==e?t:(t=s.style)!==e?t:a.resolveLooseUp(["style"]);o=o.write(m),o.data+="\r\n    ",i.line=6;var p=(t=d.links)!==e?t:(t=s.links)!==e?t:a.resolveLooseUp(["links"]);o=o.write(p),o.data+='\r\n    </head> \r\n<body class="ks-editor">\r\n',i.line=9;var v=(t=d.data)!==e?t:(t=s.data)!==e?t:a.resolveLooseUp(["data"]);o=o.write(v),o.data+="\r\n",i.line=10;var E=(t=d.script)!==e?t:(t=s.script)!==e?t:a.resolveLooseUp(["script"]);return o=o.write(E),o.data+="\r\n</body> \r\n</html>",o};return t.TPL_NAME=n.id||n.name,e}(),o=function(e){var t=e=function(e){function t(e,t){e.data,e.affix;return t.data+='\r\nstyle="overflow:scroll;-webkit-overflow-scrolling:touch;"\r\n',t}function n(e,t,n){var r=e.data,a=e.affix;t.data+="\r\n",l.line=20;var i=(o=a.xindex)!==n?o:(o=r.xindex)!==n?o:e.resolveLooseUp(["xindex"]);t=t.writeEscaped(i),t.data+='="';var s=r;return t=t.writeEscaped(s),t.data+='"\r\n',t}function r(e,t){e.data,e.affix;return t.data+='\r\nstyle="display:none"\r\n',t}{var o,a=this,i=a.root,s=a.buffer,d=a.scope,l=(a.runtime,a.name,a.pos),c=d.data,u=d.affix,f=i.nativeCommands,m=i.utils,p=(m.callFn,m.callCommand,f.range,f.foreach,f.forin,f.each),v=(f["with"],f["if"]);f.set,f.include,f.parse,f.extend,f.block,f.macro,f["debugger"]}s.data+='<div class="',l.line=1;var E=(o=u.prefixCls)!==e?o:(o=c.prefixCls)!==e?o:d.resolveLooseUp(["prefixCls"]);s=s.writeEscaped(E),s.data+='editor-tools">\r\n\r\n</div>\r\n\r\n',s.data+='\r\n\r\n<div class="',l.line=10;var T=(o=u.prefixCls)!==e?o:(o=c.prefixCls)!==e?o:d.resolveLooseUp(["prefixCls"]);s=s.writeEscaped(T),s.data+='editor-textarea-wrap"\r\n\r\n',l.line=12;var N=(o=u.mobile)!==e?o:(o=c.mobile)!==e?o:d.resolveLooseUp(["mobile"]);s=v.call(a,d,{params:[N],fn:t},s),s.data+='\r\n>\r\n\r\n<textarea class="',l.line=17;var h=(o=u.prefixCls)!==e?o:(o=c.prefixCls)!==e?o:d.resolveLooseUp(["prefixCls"]);s=s.writeEscaped(h),s.data+='editor-textarea"\r\n\r\n',l.line=19,l.line=19;var _=(o=u.textareaAttrs)!==e?o:(o=c.textareaAttrs)!==e?o:d.resolveLooseUp(["textareaAttrs"]);s=p.call(a,d,{params:[_],fn:n},s),s.data+="\r\n\r\n",l.line=23;var g=(o=u.mode)!==e?o:(o=c.mode)!==e?o:d.resolveLooseUp(["mode"]);s=v.call(a,d,{params:[g],fn:r},s),s.data+="\r\n\r\n>",l.line=27;var y=(o=u.data)!==e?o:(o=c.data)!==e?o:d.resolveLooseUp(["data"]);s=s.writeEscaped(y),s.data+='</textarea>\r\n\r\n</div>\r\n\r\n<div class="',l.line=31;var O=(o=u.prefixCls)!==e?o:(o=c.prefixCls)!==e?o:d.resolveLooseUp(["prefixCls"]);return s=s.writeEscaped(O),s.data+='editor-status">\r\n\r\n</div>\r\n',s};return t.TPL_NAME=n.id||n.name,e}(),a=function(e){function t(e){if(!i.$removeEmpty[e.nodeName])return!1;var n,r,o=e.childNodes,a=o.length;if(a){for(n=0;a>n;n++){r=o[n];var d=r.nodeType;if(d!==s.TEXT_NODE||r.nodeValue)return!1;if(!t(r))return!1}return!0}return!0}e={};var n=O,r=S,o=r.ieMode<11,a=b,i=n.DTD,s=a.Dom.NodeType,d=C;return e.init=function(e){function s(e){return!t(e)}function l(e){return e.replace(T,function(e,t,n){return"<"+t+n.replace(N,function(e,t){return-1===n.indexOf("_keSaved_"+t)?" _keSaved_"+e+" "+e:e})+">"})}function c(e){return e.replace(S,"<ke:$1$2></ke:$1>")}function u(e){return e.replace(_,function(e){return"<ke:encoded>"+encodeURIComponent(e)+"</ke:encoded>"})}function f(e){return e.replace(g,function(e,t){return d.urlDecode(t)})}function m(e){return e.replace(y,"$1ke:$2")}function p(e){return e.replace(O,"$1$2")}var v=new n.Filter,E=new n.Filter;!function(){function e(e){var t=n.serialize(e);return new n.Comment(h+encodeURIComponent(t).replace(/--/g,"%2D%2D"))}var t={tagNames:[[/^\?xml.*$/i,""],[/^.*namespace.*$/i,""]],attributeNames:[[/^on/,"ke_on"],[/^lang$/,""]],tags:{script:e,noscript:e,span:s}},r={tagNames:[[/^ke:/,""],[/^\?xml:namespace$/,""]],tags:{$:function(e){var t=e.attributes;if(t.length)for(var n,r=["name","href","src"],o=0;o<r.length;o++)n="_keSaved_"+r[o],e.getAttribute(n)&&e.removeAttribute(r[o]);return e},embed:function(e){var t=e.parentNode;if(t&&"object"===t.nodeName){var n=t.getAttribute("width"),r=t.getAttribute("height");n&&e.setAttribute("width",n),r&&e.setAttribute("width",r)}},a:function(e){return e.childNodes.length||e.attributes.length?void 0:!1},span:s,strong:s,em:s,del:s,u:s},attributes:{style:function(e){return d.trim(e)?void 0:!1}},attributeNames:[[/^_keSaved_/,""],[/^ke_on/,"on"],[/^_ke.*/,""],[/^ke:.*$/,""],[/^_ks.*/,""]],comment:function(e){return e.substr(0,h.length)===h?(e=d.trim(d.urlDecode(e.substr(h.length))),n.parse(e).childNodes[0]):void 0}};o&&(r.attributes.style=function(e){return e.replace(/(^|;)([^:]+)/g,function(e){return e.toLowerCase()})}),v.addRules(r),E.addRules(t)}(),function(){function e(e){for(var n=e.childNodes,r=n.length,o=n[r-1];o&&(3===o.nodeType&&!d.trim(o.nodeValue)||1===o.nodeType&&t(o));)o=n[--r];return o}function r(t){var n=e(t);n&&(1===n.nodeType&&"br"===n.nodeName?t.removeChild(n):3===n.nodeType&&u.test(n.nodeValue)&&t.removeChild(n))}function a(t){var n=e(t);return!n||"form"===t.nodeName&&"input"===n.nodeName}function s(e){r(e),a(e)&&(o||e.appendChild(new n.Tag("br")))}function l(e){r(e),a(e)&&e.appendChild(new n.Text("Â "))}var c,u=/^[\t\r\n ]*(?:&nbsp;|\xa0)[\t\r\n ]*$/,f=d.merge(i.$block,i.$listItem,i.$tableContent);for(c in f)"br"in i[c]||delete f[c];delete f.pre;var m={tags:{}},p={tags:{}};for(c in f)m.tags[c]=s,p.tags[c]=l;E.addRules(m),v.addRules(p)}(),v.addRules({text:function(e){return e.replace(/\xa0/g,"&nbsp;")}});var T=/<(a|area|img|input)\b([^>]*)>/gi,N=/\b(href|src|name)\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|(?:[^ "'>]+))/gi,h="{ke_protected}",_=/(?:<textarea[^>]*>[\s\S]*<\/textarea>)|(?:<style[^>]*>[\s\S]*<\/style>)|(?:<script[^>]*>[\s\S]*<\/script>)|(?:<(:?link|meta|base)[^>]*>)/gi,g=/<ke:encoded>([^<]*)<\/ke:encoded>/gi,y=/(<\/?)((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,O=/(<\/?)ke:((?:object|embed|param|html|body|head|title|noscript)[^>]*>)/gi,S=/<ke:(param|embed)([^>]*?)\/?>(?!\s*<\/ke:\1)/gi;e.htmlDataProcessor={dataFilter:E,htmlFilter:v,toHtml:function(e){r.webkit&&(e=e.replace(/\u200b/g,""));var t=new n.BeautifyWriter,o=new n.Parser(e).parse();return o.writeHtml(t,v),e=t.getHtml()},toDataFormat:function(e,t){t=t||E,e=u(e),e=l(e),e=m(e),e=c(e);var r=a("<div>");r.html("a"+e),e=r.html().substr(1),e=p(e),e=f(e);var o=new n.BasicWriter,i=new n.Parser(e).parse();return i.writeHtml(o,t),e=o.getHtml()},toServer:function(e){var t=new n.MinifyWriter,r=new n.Parser(e).parse();return r.writeHtml(t,v),t.getHtml()}}},e}(),i=function(e){var t=r,n=k,o=new n(t);return e=function(){return o.render.apply(o,arguments)}}(),s=function(e){var t=o,n=k,r=new n(t);return e=function(){return r.render.apply(r,arguments)}}(),d=function(e){var t=C,n=S,r=O,o=I,a=s;return e=o.extend({beforeCreateDom:function(e){t.mix(e,{mobile:n.mobile})}},{Config:{},XHTML_DTD:r.DTD,ATTRS:{handleGestureEvents:{value:!1},focusable:{value:!1},allowTextSelection:{value:!0},contentTpl:{value:a},height:{value:300},textarea:{selector:function(){return"."+this.getBaseCssClass("textarea")}},textareaAttrs:{render:1,sync:0},iframe:{},window:{},document:{},toolBarEl:{selector:function(){return"."+this.getBaseCssClass("tools")}},statusBarEl:{selector:function(){return"."+this.getBaseCssClass("status")}},mode:{render:1,value:1},data:{render:1,sync:0},customStyle:{value:""},customLink:{value:[]}},xclass:"editor"})}(),l=function(e){var t=C,n=b,r=d,o=!0,a=!1,i=null,s=R,l=S,c={debugUrl:function(){return""},lazyRun:function(e,t,n){var r=e[t],o=e[n];e[t]=function(){return r.apply(this,arguments),e[t]=e[n],o.apply(this,arguments)}},getXY:function(e,t){var n=e.left,r=e.top,o=t.get("window")[0];n-=s.scrollLeft(o),r-=s.scrollTop(o);var a=t.get("iframe").offset();return n+=a.left,r+=a.top,{left:n,top:r}},tryThese:function(){for(var e,t=0,n=arguments.length;n>t;t++){var r=arguments[t];try{e=r();break}catch(o){}}return e},clearAllMarkers:function(e){for(var t in e)e[t]._4eClearMarkers(e,o,void 0)},ltrim:function(e){return e.replace(/^\s+/,"")},rtrim:function(e){return e.replace(/\s+$/,"")},isNumber:function(e){return/^\d+(.\d+)?$/.test(t.trim(e))},verifyInputs:function(e){for(var r=0;r<e.length;r++){var i=n(e[r]),s=t.trim(c.valInput(i)),d=i.attr("data-verify"),l=i.attr("data-warning");if(d&&!new RegExp(d).test(s))return alert(l),a}return o},sourceDisable:function(e,t){e.on("sourceMode",t.disable,t),e.on("wysiwygMode",t.enable,t)},resetInput:function(e){var t=e.attr("placeholder");t&&l.ie?(e.addClass("ks-editor-input-tip"),e.val(t)):l.ie||e.val("")},valInput:function(e,t){return void 0===t?e.hasClass("ks-editor-input-tip")?"":e.val():(e.removeClass("ks-editor-input-tip"),e.val(t),void 0)},placeholder:function(e,n){e.attr("placeholder",n),l.ie&&(e.on("blur",function(){t.trim(e.val())||(e.addClass("ks-editor-input-tip"),e.val(n))}),e.on("focus",function(){e.removeClass("ks-editor-input-tip"),t.trim(e.val())===n&&e.val("")}))},normParams:function(e){e=t.clone(e);for(var n in e){var r=e[n];"function"==typeof r&&(e[n]=r())}return e},preventFocus:function(e){l.ie?e.unselectable():e.attr("onmousedown","return false;")},injectDom:function(e){t.mix(s,e);for(var r in e)!function(r){n.prototype[r]=function(){var o=[].slice.call(arguments,0);o.unshift(this[0]);var a=e[r].apply(i,o);return a&&(a.nodeType||t.isWindow(a))?n(a):t.isArray(a)&&(a.__IS_NODELIST||a[0]&&a[0].nodeType)?n(a):a}}(r)},addRes:function(){this.__res=this.__res||[];var e=this.__res;e.push.apply(e,t.makeArray(arguments))},destroyRes:function(){for(var e=this.__res||[],t=0;t<e.length;t++){var n=e[t];"function"==typeof n?n():n.destroy?n.destroy():n.remove&&n.remove()}this.__res=[]},getQueryCmd:function(e){return"query"+("-"+e).replace(/-(\w)/g,function(e,t){return t.toUpperCase()})+"Value"}};return r.Utils=c,e=c}(),c=function(e){function t(){var e=this;e.__iframeFocus=s,o=e,r&&clearTimeout(r),r=setTimeout(function(){e.fire("focus")},30)}function n(){var e=this;e.__iframeFocus=l,o=c,r&&clearTimeout(r),r=setTimeout(function(){e.fire("blur")},30)}var r,o,a=d,i={},s=!0,l=!1,c=null,u=e={currentInstance:function(){return o},getInstance:function(e){return i[e]},register:function(e){i[e.get("id")]=e},add:function(e){this.register(e),e.get("window").on("focus",t,e).on("blur",n,e)},remove:function(e){delete i[e.get("id")],e.get("window").detach("focus",t,e).detach("blur",n,e)}};return a.focusManager=u,a.getInstances=function(){return i},e}(),y=function(e){function t(e,t){var n=e[t?"next":"prev"](void 0,1);if(n&&n[0].nodeType===m.ELEMENT_NODE){for(var o=[];n.attr("_ke_bookmark")||n._4eIsEmptyInlineRemovable(void 0);)if(o.push(n),n=t?n.next(void 0,1):n.prev(void 0,1),!n)return;if(e._4eIsIdentical(n,void 0)){for(var a=r(t?e[0].lastChild:e[0].firstChild);o.length;)o.shift()._4eMove(e,!t,void 0);n._4eMoveChildren(e,!t,void 0),n.remove(),a[0]&&a[0].nodeType===m.ELEMENT_NODE&&a._4eMergeSiblings()}}}var n=C,r=b,o=d,a=l,i=!0,s=!1,c=null,u=o.XHTML_DTD,f=R,m=f.NodeType,p=S,v={a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};o.PositionType={POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16};var E=o.PositionType,T={block:1,"list-item":1,table:1,"table-row-group":1,"table-header-group":1,"table-footer-group":1,"table-row":1,"table-column-group":1,"table-column":1,"table-cell":1,"table-caption":1},N={hr:1},h=function(e){return e&&(e[0]||e)},_=function(e){return r(e)},g={_4eSameLevel:function(e,t){t=h(t);var n=e.parentNode;return n&&n===t.parentNode},_4eIsBlockBoundary:function(e,t){var r=n.merge(N,t);return!(!T[f.css(e,"display")]&&!r[f.nodeName(e)])},_4eIndex:function(e,t){for(var n,r=e.parentNode.childNodes,o=-1,a=0;a<r.length;a++)if(n=r[a],!(t&&3===n.nodeType&&n.previousSibling&&3===n.previousSibling.nodeType||(o++,n!==e)))return o;return-1},_4eMove:function(e,t,n){t=h(t),n?t.insertBefore(e,t.firstChild):t.appendChild(e)},_4eIsIdentical:function(e,t){if(!t)return s;if(t=h(t),f.nodeName(e)!==f.nodeName(t))return s;var n,r,o=e.attributes,a=t.attributes,d=o.length,l=a.length;if(d!==l)return s;for(var c=0;d>c;c++)if(n=o[c],r=n.name,n.specified&&f.attr(e,r)!==f.attr(t,r))return s;if(p.ieMode<8)for(c=0;l>c;c++)if(n=a[c],r=n.name,n.specified&&f.attr(e,r)!==f.attr(t,r))return s;return i},_4eIsEmptyInlineRemovable:function(e){if(!u.$removeEmpty[f.nodeName(e)])return!1;for(var t=e.childNodes,r=0,o=t.length;o>r;r++){var a=t[r],d=a.nodeType;if((d!==m.ELEMENT_NODE||!a.getAttribute("_ke_bookmark"))&&(d===m.ELEMENT_NODE&&!f._4eIsEmptyInlineRemovable(a)||d===f.NodeType.TEXT_NODE&&n.trim(a.nodeValue)))return s}return i},_4eMoveChildren:function(e,t,n){if(t=h(t),e!==t){var r;if(n)for(;r=e.lastChild;)t.insertBefore(e.removeChild(r),t.firstChild);else for(;r=e.firstChild;)t.appendChild(e.removeChild(r))}},_4eMergeSiblings:function(e){e=_(e),v[e.nodeName()]&&(t(e,i),t(e))},_4eSplitText:function(e,t){var n=e.ownerDocument;if(e.nodeType!==f.NodeType.TEXT_NODE)return void 0;if(p.ie&&t===e.nodeValue.length){var r=n.createTextNode("");return f.insertAfter(r,e),r}var o=e.splitText(t);if(n.documentMode){var a=n.createTextNode("");f.insertAfter(a,o),f.remove(a)}return o},_4eParents:function(e,t){var n=[];n.__IS_NODELIST=1;do n[t?"push":"unshift"](e);while(e=e.parentNode);return n},_4eNextSourceNode:function(e,t,n,r){if(r&&!r.call){var o=h(r);r=function(e){return e!==o}}var a=!t&&e.firstChild,d=e;if(!a){if(e.nodeType===m.ELEMENT_NODE&&r&&r(e,i)===s)return c;a=e.nextSibling}for(;!a&&(d=d.parentNode);){if(r&&r(d,i)===s)return c;a=d.nextSibling}return a?r&&r(a)===s?c:n&&n!==a.nodeType?f._4eNextSourceNode(a,s,n,r):a:c},_4ePreviousSourceNode:function(e,t,n,r){if(r&&!r.call){var o=h(r);r=function(e){return e!==o}}var a=!t&&e.lastChild,d=e;if(!a){if(e.nodeType===m.ELEMENT_NODE&&r&&r(e,i)===s)return c;a=e.previousSibling}for(;!a&&(d=d.parentNode);){if(r&&r(d,i)===s)return c;a=d.previousSibling}return a?r&&r(a)===s?c:n&&a.nodeType!==n?f._4ePreviousSourceNode(a,s,n,r):a:c},_4eCommonAncestor:function(e,t){if(t=h(t),e===t)return e;if(f.contains(t,e))return t;var n=e;do if(f.contains(n,t))return n;while(n=n.parentNode);return c},_4eHasAttributes:p.ieMode<9?function(e){for(var t=e.attributes,n=0;n<t.length;n++){var r=t[n];switch(r.name){case"class":if(e.getAttribute("class"))return i;break;default:if(r.specified)return i}}return s}:function(e){return p.gecko&&e.removeAttribute("_moz_dirty"),e.hasAttributes()},_4ePosition:function(e,t){var n=h(t);if(e.compareDocumentPosition)return e.compareDocumentPosition(n);if(e===n)return E.POSITION_IDENTICAL;if(e.nodeType===m.ELEMENT_NODE&&n.nodeType===m.ELEMENT_NODE){if(f.contains(e,n))return E.POSITION_CONTAINS+E.POSITION_PRECEDING;if(f.contains(n,e))return E.POSITION_IS_CONTAINED+E.POSITION_FOLLOWING;if("sourceIndex"in e)return e.sourceIndex<0||n.sourceIndex<0?E.POSITION_DISCONNECTED:e.sourceIndex<n.sourceIndex?E.POSITION_PRECEDING:E.POSITION_FOLLOWING}for(var r=f._4eAddress(e),o=f._4eAddress(n),a=Math.min(r.length,o.length),i=0;a-1>=i;i++)if(r[i]!==o[i])return r[i]<o[i]?E.POSITION_PRECEDING:E.POSITION_FOLLOWING;return r.length<o.length?E.POSITION_CONTAINS+E.POSITION_PRECEDING:E.POSITION_IS_CONTAINED+E.POSITION_FOLLOWING},_4eAddress:function(e,t){for(var n=[],r=e.ownerDocument.documentElement,o=e;o&&o!==r;)n.unshift(f._4eIndex(o,t)),o=o.parentNode;return n},_4eRemove:function(e,t){var n=e.parentNode;if(n){if(t)for(var r;r=e.firstChild;)n.insertBefore(e.removeChild(r),e);n.removeChild(e)}return e},_4eTrim:function(e){f._4eLtrim(e),f._4eRtrim(e)},_4eLtrim:function(e){for(var t;t=e.firstChild;){if(t.nodeType===f.NodeType.TEXT_NODE){var n=a.ltrim(t.nodeValue),r=t.nodeValue.length;if(!n){e.removeChild(t);continue}n.length<r&&(f._4eSplitText(t,r-n.length),e.removeChild(e.firstChild))}break}},_4eRtrim:function(e){for(var t;t=e.lastChild;){if(t.type===f.NodeType.TEXT_NODE){var n=a.rtrim(t.nodeValue),r=t.nodeValue.length;if(!n){e.removeChild(t);continue}n.length<r&&(f._4eSplitText(t,n.length),e.removeChild(e.lastChild))}break}p.ie||(t=e.lastChild,t&&1===t.nodeType&&"br"===f.nodeName(t)&&e.removeChild(t))},_4eAppendBogus:function(e){for(var t,r=e.lastChild;r&&r.nodeType===f.NodeType.TEXT_NODE&&!n.trim(r.nodeValue);)r=r.previousSibling;r&&r.nodeType!==f.NodeType.TEXT_NODE&&"br"===f.nodeName(r)||(t=e.ownerDocument.createElement("br"),e.appendChild(t))},_4eSetMarker:function(e,t,r,o){e=_(e);var a=e.data("list_marker_id")||e.data("list_marker_id",n.guid()).data("list_marker_id"),i=e.data("list_marker_names")||e.data("list_marker_names",{}).data("list_marker_names");return t[a]=e,i[r]=1,e.data(r,o)},_4eClearMarkers:function(e,t,n){e=_(e);var r=e.data("list_marker_names"),o=e.data("list_marker_id");for(var a in r)e.removeData(a);e.removeData("list_marker_names"),n&&(e.removeData("list_marker_id"),delete t[o])},_4eCopyAttributes:function(e,t,n){t=_(t);var r=e.attributes;n=n||{};for(var o=0;o<r.length;o++){var a,i=r[o],s=i.name.toLowerCase();s in n||("checked"===s&&(a=f.attr(e,s))?t.attr(s,a):(i.specified||p.ie&&i.value&&"value"===s)&&(a=f.attr(e,s),a===c&&(a=i.nodeValue),t.attr(s,a)))}""!==e.style.cssText&&(t[0].style.cssText=e.style.cssText)},_4eIsEditable:function(e){var t=f.nodeName(e),n=!u.$nonEditable[t]&&(u[t]||u.span);return n&&n["#text"]},_4eGetByAddress:function(e,t,n){for(var r=e.documentElement,o=0;r&&o<t.length;o++){var a=t[o];if(n)for(var s=-1,d=0;d<r.childNodes.length;d++){var l=r.childNodes[d];if((n!==i||3!==l.nodeType||!l.previousSibling||3!==l.previousSibling.nodeType)&&(s++,s===a)){r=l;break}}else r=r.childNodes[a]}return r}};return a.injectDom(g),e}(),u=function(e){function t(e,t){var n=this;if(n._.end)return c;var r,o,a=n.range,i=n.guard,d=n.type,u=e?"_4ePreviousSourceNode":"_4eNextSourceNode";if(!n._.start&&(n._.start=1,a.trim(),a.collapsed))return n.end(),c;if(!e&&!n._.guardLTR){var m=a.endContainer[0],v=m.childNodes[a.endOffset];this._.guardLTR=function(e,t){return!t||m!==e&&"body"!==f.nodeName(e)?e!==v:!1}}if(e&&!n._.guardRTL){var E=a.startContainer[0],T=a.startOffset>0&&E.childNodes[a.startOffset-1]||null;n._.guardRTL=function(e,t){return!t||E!==e&&"body"!==f.nodeName(e)?e!==T:!1}}var N=e?n._.guardRTL:n._.guardLTR;for(o=i?function(e,t){return N(e,t)===l?l:i(e,t)}:N,n.current?r=this.current[u](l,d,o):e?(r=a.endContainer,a.endOffset>0?(r=p(r[0].childNodes[a.endOffset-1]),o(r[0])===l&&(r=c)):r=o(r,s)===l?c:r._4ePreviousSourceNode(s,d,o,void 0)):(r=a.startContainer,r=p(r[0].childNodes[a.startOffset]),r.length?o(r[0])===l&&(r=c):r=o(a.startContainer,s)===l?c:a.startContainer._4eNextSourceNode(s,d,o,void 0));r&&!n._.end;){if(n.current=r,n.evaluator&&n.evaluator(r[0])===l){if(t&&n.evaluator)return l}else if(!t)return r;r=r[u](l,d,o)}return n.end(),n.current=c,c}function n(e){for(var n,r=c;n=t.call(this,e);)r=n;return r}function r(e){this.range=e,this.evaluator=c,this.guard=c,this._={}}function o(e){do e=e._4ePreviousSourceNode();while(e&&N(e[0]));return e&&(u.ie?3===e[0].nodeType&&v.test(e.text()):"br"===e.nodeName())?e[0]:!1}var a=d,i=C,s=!0,l=!1,c=null,u=S,f=R,m=a.XHTML_DTD,p=b;i.augment(r,{end:function(){this._.end=1},next:function(){return t.call(this)},previous:function(){return t.call(this,s)},checkForward:function(){return t.call(this,l,s)!==l},checkBackward:function(){return t.call(this,s,s)!==l},lastForward:function(){return n.call(this)},lastBackward:function(){return n.call(this,s)},reset:function(){delete this.current,this._={}},_iterator:t}),i.mix(r,{blockBoundary:function(e){return function(t){return!(t.nodeType===f.NodeType.ELEMENT_NODE&&f._4eIsBlockBoundary(t,e))}},bookmark:function(e,t){function n(e){return"span"===f.nodeName(e)&&f.attr(e,"_ke_bookmark")}return function(r){var o,a;return o=r.nodeType===f.NodeType.TEXT_NODE&&(a=r.parentNode)&&n(a),o=e?o:o||n(r),!!(t^o)}},whitespaces:function(e){return function(t){var n=t.nodeType===f.NodeType.TEXT_NODE&&!i.trim(t.nodeValue);return!!(e^n)}},invisible:function(e){var t=r.whitespaces();return function(n){var r=t(n)||n.nodeType===f.NodeType.ELEMENT_NODE&&!n.offsetHeight;return!!(e^r)}}});var v=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,E=r.whitespaces(),T=r.bookmark(),N=function(e){var t=f.nodeName(e);return T(e)||E(e)||1===e.nodeType&&t in m.$inline&&!(t in m.$empty)};return a.Utils.injectDom({_4eGetBogus:function(e){return o(p(e))}}),a.Walker=r,e=r}(),f=function(e){function t(e){for(var t=this,n=s,o=s,a=[],i=e;i;){if(i[0].nodeType===r.NodeType.ELEMENT_NODE){this.lastElement||(this.lastElement=i);var d=i.nodeName();if(o||(!n&&l[d]&&(n=i),c[d]&&(n||"div"!==d||u(i)?o=i:n=i)),a.push(i),"body"===d)break}i=i.parent()}t.block=n,t.blockLimit=o,t.elements=a}var n=d,r=R,o=n.XHTML_DTD,a=!0,i=!1,s=null,l={address:1,blockquote:1,dl:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1,li:1,dt:1,dd:1},c={body:1,div:1,table:1,tbody:1,tr:1,td:1,th:1,caption:1,form:1},u=function(e){for(var t=e[0].childNodes,n=0,s=t.length;s>n;n++){var d=t[n];if(d.nodeType===r.NodeType.ELEMENT_NODE&&o.$block[d.nodeName.toLowerCase()])return a}return i};return t.prototype={constructor:t,compare:function(e){var t=this.elements,n=e&&e.elements;if(!n||t.length!==n.length)return i;for(var o=0;o<t.length;o++)if(!r.equals(t[o],n[o]))return i;return a},contains:function(e){for(var t=this.elements,n=0;n<t.length;n++)if(t[n].nodeName()in e)return t[n];return s},toString:function(){var e,t=this.elements,n=[];for(e=0;e<t.length;e++)n.push(t[e].nodeName());return n.toString()}},n.ElementPath=t,e=t}(),m=function(e){function t(e){for(var t=e.getSelection().getRanges(),n=t.length-1;n>0;n--)t[n].deleteContents();return t[0]}function n(e){var n=t(e),r=n.document,d=new c(n.startContainer),u=n.checkStartOfBlock(),f=n.checkEndOfBlock(),E=d.block;if(u&&f){if(E&&("li"===E.nodeName()||"li"===E.parent().nodeName()))return e.hasCommand("outdent")?(e.execCommand("save"),e.execCommand("outdent"),e.execCommand("save"),!0):!1}else if(E&&"pre"===E.nodeName()&&!f){var T=i.ieMode<9?a(r.createTextNode("\r")):a(r.createElement("br"));return n.insertNode(T),i.ieMode<9?(T=a(r.createTextNode("ï»¿")).insertAfter(T),n.setStartAt(T,l.RangeType.POSITION_AFTER_START)):n.setStartAfter(T),n.collapse(!0),n.select(),i.ieMode<9&&(T[0].nodeValue=""),void 0}var N="p",h=n.splitBlock(N);if(!h)return!0;var _=h.previousBlock,g=h.nextBlock;u=h.wasStartOfBlock,f=h.wasEndOfBlock;var y;g?(y=g.parent(),"li"===y.nodeName()&&(g._4eBreakParent(y),g._4eMove(g.next(),!0))):_&&(y=_.parent())&&"li"===y.nodeName()&&(_._4eBreakParent(y),n.moveToElementEditablePosition(_.next()),_._4eMove(_.prev()));var O;if(u||f){_?"li"!==_.nodeName()&&p.test(_.nodeName())||(O=_.clone()):g&&(O=g.clone()),O||(O=a("<"+N+">",null,r));var S=h.elementPath;if(S)for(var b=0,C=S.elements.length;C>b;b++){var k=S.elements[b];if(k.equals(S.block)||k.equals(S.blockLimit))break;v.$removeEmpty[k.nodeName()]&&(k=k.clone(),O._4eMoveChildren(k),O.append(k))}m||O._4eAppendBogus(),n.insertNode(O),!m||!u||f&&_[0].childNodes.length||(n.moveToElementEditablePosition(f?_:O),n.select()),n.moveToElementEditablePosition(u&&!f?g:O)}else"li"===g.nodeName()&&(y=g.first(s.invisible(!0)))&&o.inArray(y.nodeName(),["ul","ol"])&&(m?a(r.createTextNode("Â ")):a(r.createElement("br"))).insertBefore(y),g&&n.moveToElementEditablePosition(g);if(!m)if(g){var I=a(r.createElement("span"));I.html("&nbsp;"),n.insertNode(I),I.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),n.deleteContents()}else O.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0});return n.select(),!0}function r(e){var t=e.get("document");t.on("keydown",function(t){var n=t.keyCode;if(13===n&&!(t.shiftKey||t.ctrlKey||t.metaKey)){e.execCommand("save");var r=e.execCommand("enterBlock");e.execCommand("save"),r!==!1&&t.preventDefault()}})}e={};var o=C,a=b,i=S,s=u,l=d,c=f,m=i.ieMode<11,p=/^(?:h[1-6])|(?:pre)$/i,v=l.XHTML_DTD;return e.init=function(e){e.addCommand("enterBlock",{exec:n}),e.docReady(function(){r(e)})},e}(),p=function(e){var t=d,n=t.ZIndexManager={BUBBLE_VIEW:1100,POPUP_MENU:1200,STORE_FLASH_SHOW:99999,MAXIMIZE:900,OVERLAY:9999,LOADING:11e3,LOADING_CANCEL:12e3,SELECT:1200};return t.baseZIndex=function(e){return(t.Config.baseZIndex||1e4)+e},e=n}(),v=function(e){function t(e){var t=e.nodeType!==g.NodeType.TEXT_NODE&&g.nodeName(e)in O.$removeEmpty,n=e.nodeType===g.NodeType.TEXT_NODE&&!v.trim(e.nodeValue),r=!!e.parentNode.getAttribute("_ke_bookmark");return t||n||r}function n(e){return!L(e)&&!D(e)}function r(e){var t=T;return function(n){if(D(n))return E;if(n.nodeType===g.NodeType.TEXT_NODE){if(v.trim(n.nodeValue).length)return T}else if(n.nodeType===g.NodeType.ELEMENT_NODE){var r=g.nodeName(n);if(!B[r]){if(e||y.ie||"br"!==r||t)return T;t=E}}return E}}function o(e,t){var n,r,o,a,i=e.startContainer,s=e.endContainer,d=e.startOffset,l=e.endOffset,c=T,u=T,f=e.document;if(t>0&&(o=f.createDocumentFragment()),e.collapsed)return o;e.optimizeBookmark(),s[0].nodeType===g.NodeType.TEXT_NODE?(u=E,s=s._4eSplitText(l)):s[0].childNodes.length>0&&(l>=s[0].childNodes.length?(s=k(s[0].appendChild(f.createTextNode(""))),a=E):s=k(s[0].childNodes[l])),i[0].nodeType===g.NodeType.TEXT_NODE?(c=E,i._4eSplitText(d)):d?d>=i[0].childNodes.length?(i=k(i[0].appendChild(f.createTextNode(""))),n=E):i=k(i[0].childNodes[d].previousSibling):(r=k(f.createTextNode("")),i.prepend(r),i=r,n=E);var m=i._4eParents(),p=s._4eParents();m.each(function(e,t){m[t]=e}),p.each(function(e,t){p[t]=e});var v,N,h;for(v=0;v<m.length&&(N=m[v],h=p[v],N.equals(h));v++);for(var _,y,O,S,b=o,C=v;C<m.length;C++){_=m[C],y=t>0&&!_.equals(i)?b.appendChild(_.clone()[0]):null,O=_[0].nextSibling;for(var R=p[C],x=s[0],L=R&&R[0];O&&L!==O&&x!==O;){if(S=O.nextSibling,2===t)b.appendChild(O.cloneNode(E));else{if(I[O.nodeName.toLowerCase()]){var D=O.cloneNode(E);O.innerHTML="",O=D}else g._4eRemove(O);1===t&&b.appendChild(O)}O=S}y&&(b=y)}b=o;for(var w=v;w<p.length;w++){if(_=p[w],y=t>0&&!_.equals(s)?b.appendChild(_.clone()[0]):null,!m[w]||!_._4eSameLevel(m[w]))for(O=_[0].previousSibling;O;)S=O.previousSibling,2===t?b.insertBefore(O.cloneNode(E),b.firstChild):(g._4eRemove(O),1===t&&b.insertBefore(O,b.firstChild)),O=S;y&&(b=y)}if(2===t){if(c){var A=i[0];A.nodeType===g.NodeType.TEXT_NODE&&A.nextSibling&&A.nextSibling.nodeType===g.NodeType.TEXT_NODE&&(A.data+=A.nextSibling.data,A.parentNode.removeChild(A.nextSibling))}if(u){var B=s[0];B.nodeType===g.NodeType.TEXT_NODE&&B.previousSibling&&B.previousSibling.nodeType===g.NodeType.TEXT_NODE&&(B.previousSibling.data+=B.data,B.parentNode.removeChild(B))}}else{if(N&&h&&(!i._4eSameLevel(N)||!s._4eSameLevel(h))){var P=N._4eIndex();n&&N._4eSameLevel(i)&&P--,e.setStart(N.parent(),P+1)}e.collapse(E)}return n&&i.remove(),a&&s.remove(),o}function a(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer[0]===e.endContainer[0]&&e.startOffset===e.endOffset}function i(e){var t=this;t.startContainer=N,t.startOffset=N,t.endContainer=N,t.endOffset=N,t.collapsed=E,t.document=e}var s=l,c=u,m=d,p=f,v=C;m.RangeType={POSITION_AFTER_START:1,POSITION_BEFORE_END:2,POSITION_BEFORE_START:3,POSITION_AFTER_END:4,ENLARGE_ELEMENT:1,ENLARGE_BLOCK_CONTENTS:2,ENLARGE_LIST_ITEM_CONTENTS:3,START:1,END:2,SHRINK_ELEMENT:1,SHRINK_TEXT:2};var E=!0,T=!1,N=null,h=m.RangeType,_=m.PositionType,g=R,y=S,O=m.XHTML_DTD,k=b,I={td:1},x={area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1},L=new c.whitespaces,D=new c.bookmark,w=c.whitespaces(E),A=c.bookmark(!1,!0),B={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1};return v.augment(i,{toString:function(){var e=[],t=this,n=t.startContainer[0],r=t.endContainer[0];return e.push((n.id||n.nodeName)+":"+t.startOffset),e.push((r.id||r.nodeName)+":"+t.endOffset),e.join("<br/>")},optimize:function(){var e=this,t=e.startContainer,n=e.startOffset;t[0].nodeType!==g.NodeType.ELEMENT_NODE&&(n?n>=t[0].nodeValue.length&&e.setStartAfter(t):e.setStartBefore(t)),t=e.endContainer,n=e.endOffset,t[0].nodeType!==g.NodeType.ELEMENT_NODE&&(n?n>=t[0].nodeValue.length&&e.setEndAfter(t):e.setEndBefore(t))},setStartAfter:function(e){this.setStart(e.parent(),e._4eIndex()+1)},setStartBefore:function(e){this.setStart(e.parent(),e._4eIndex())},setEndAfter:function(e){this.setEnd(e.parent(),e._4eIndex()+1)},setEndBefore:function(e){this.setEnd(e.parent(),e._4eIndex())},optimizeBookmark:function(){var e=this,t=e.startContainer,n=e.endContainer;t&&"span"===t.nodeName()&&t.attr("_ke_bookmark")&&e.setStartBefore(t),n&&"span"===n.nodeName()&&n.attr("_ke_bookmark")&&e.setEndAfter(n)},setStart:function(e,t){var n=this;e[0].nodeType===g.NodeType.ELEMENT_NODE&&x[e.nodeName()]&&(e=e.parent(),t=e._4eIndex()),n.startContainer=e,n.startOffset=t,n.endContainer||(n.endContainer=e,n.endOffset=t),a(n)},setEnd:function(e,t){var n=this;e[0].nodeType===g.NodeType.ELEMENT_NODE&&x[e.nodeName()]&&(e=e.parent(),t=e._4eIndex()+1),n.endContainer=e,n.endOffset=t,n.startContainer||(n.startContainer=e,n.startOffset=t),a(n)},setStartAt:function(e,t){var n=this;switch(t){case h.POSITION_AFTER_START:n.setStart(e,0);break;case h.POSITION_BEFORE_END:e[0].nodeType===g.NodeType.TEXT_NODE?n.setStart(e,e[0].nodeValue.length):n.setStart(e,e[0].childNodes.length);break;case h.POSITION_BEFORE_START:n.setStartBefore(e);break;case h.POSITION_AFTER_END:n.setStartAfter(e)}a(n)},setEndAt:function(e,t){var n=this;switch(t){case h.POSITION_AFTER_START:n.setEnd(e,0);break;case h.POSITION_BEFORE_END:e[0].nodeType===g.NodeType.TEXT_NODE?n.setEnd(e,e[0].nodeValue.length):n.setEnd(e,e[0].childNodes.length);break;case h.POSITION_BEFORE_START:n.setEndBefore(e);break;case h.POSITION_AFTER_END:n.setEndAfter(e)}a(n)},cloneContents:function(){return o(this,2)},deleteContents:function(){return o(this,0)},extractContents:function(){return o(this,1)},collapse:function(e){var t=this;e?(t.endContainer=t.startContainer,t.endOffset=t.startOffset):(t.startContainer=t.endContainer,t.startOffset=t.endOffset),t.collapsed=E},clone:function(){var e=this,t=new i(e.document);return t.startContainer=e.startContainer,t.startOffset=e.startOffset,t.endContainer=e.endContainer,t.endOffset=e.endOffset,t.collapsed=e.collapsed,t},getEnclosedNode:function(){var e=this.clone();if(e.optimize(),e.startContainer[0].nodeType!==g.NodeType.ELEMENT_NODE||e.endContainer[0].nodeType!==g.NodeType.ELEMENT_NODE)return N;var t,n,r=new c(e);return r.evaluator=function(e){return w(e)&&A(e)},t=r.next(),r.reset(),n=r.previous(),t&&t.equals(n)?t:N},shrink:function(e,t){var n=this;if(!n.collapsed){e=e||h.SHRINK_TEXT;var r,o,a=n.clone(),i=n.startContainer,s=n.endContainer,d=n.startOffset,l=n.endOffset,u=E,f=E;if(i&&i[0].nodeType===g.NodeType.TEXT_NODE&&(d?d>=i[0].nodeValue.length?a.setStartAfter(i):(a.setStartBefore(i),u=T):a.setStartBefore(i)),s&&s[0].nodeType===g.NodeType.TEXT_NODE&&(l?l>=s[0].nodeValue.length?a.setEndAfter(s):(a.setEndAfter(s),f=T):a.setEndBefore(s)),(u||f)&&(o=new c(a),o.evaluator=function(t){return t.nodeType===(e===h.SHRINK_ELEMENT?g.NodeType.ELEMENT_NODE:g.NodeType.TEXT_NODE)},o.guard=function(t,n){return e===h.SHRINK_ELEMENT&&t.nodeType===g.NodeType.TEXT_NODE?T:n&&t===r?T:(n||t.nodeType!==g.NodeType.ELEMENT_NODE||(r=t),E)}),u){var m=o[e===h.SHRINK_ELEMENT?"lastForward":"next"]();
m&&n.setStartAt(m,t?h.POSITION_AFTER_START:h.POSITION_BEFORE_START)}if(f){o.reset();var p=o[e===h.SHRINK_ELEMENT?"lastBackward":"previous"]();p&&n.setEndAt(p,t?h.POSITION_BEFORE_END:h.POSITION_AFTER_END)}return u||f}},createBookmark2:function(e){var t,n,r=this,o=r.startContainer,a=r.endContainer,i=r.startOffset,s=r.endOffset;if(!o||!a)return{start:0,end:0};if(e){for(o[0].nodeType===g.NodeType.ELEMENT_NODE&&(t=k(o[0].childNodes[i]),t&&t[0]&&t[0].nodeType===g.NodeType.TEXT_NODE&&i>0&&t[0].previousSibling.nodeType===g.NodeType.TEXT_NODE&&(o=t,i=0));o[0].nodeType===g.NodeType.TEXT_NODE&&(n=o.prev(void 0,1))&&n[0].nodeType===g.NodeType.TEXT_NODE;)o=n,i+=n[0].nodeValue.length;if(!r.collapsed)for(a[0].nodeType===g.NodeType.ELEMENT_NODE&&(t=k(a[0].childNodes[s]),t&&t[0]&&t[0].nodeType===g.NodeType.TEXT_NODE&&s>0&&t[0].previousSibling.nodeType===g.NodeType.TEXT_NODE&&(a=t,s=0));a[0].nodeType===g.NodeType.TEXT_NODE&&(n=a.prev(void 0,1))&&n[0].nodeType===g.NodeType.TEXT_NODE;)a=n,s+=n[0].nodeValue.length}return{start:o._4eAddress(e),end:r.collapsed?N:a._4eAddress(e),startOffset:i,endOffset:s,normalized:e,is2:E}},createBookmark:function(e){var t,n,r,o,a=this,i=a.collapsed;return t=k("<span>",N,a.document),t.attr("_ke_bookmark",1),t.css("display","none"),t.html("&nbsp;"),e&&(r=v.guid("ke_bm_"),t.attr("id",r+"S")),i||(n=t.clone(),n.html("&nbsp;"),e&&n.attr("id",r+"E"),o=a.clone(),o.collapse(),o.insertNode(n)),o=a.clone(),o.collapse(E),o.insertNode(t),n?(a.setStartAfter(t),a.setEndBefore(n)):a.moveToPosition(t,h.POSITION_AFTER_END),{startNode:e?r+"S":t,endNode:e?r+"E":n,serializable:e,collapsed:i}},moveToPosition:function(e,t){var n=this;n.setStartAt(e,t),n.collapse(E)},trim:function(e,t){var n=this,r=n.startContainer,o=n.startOffset,a=n.collapsed;if((!e||a)&&r[0]&&r[0].nodeType===g.NodeType.TEXT_NODE){if(o)if(o>=r[0].nodeValue.length)o=r._4eIndex()+1,r=r.parent();else{var i=r._4eSplitText(o);o=r._4eIndex()+1,r=r.parent(),g.equals(n.startContainer,n.endContainer)?n.setEnd(i,n.endOffset-n.startOffset):g.equals(r,n.endContainer)&&(n.endOffset+=1)}else o=r._4eIndex(),r=r.parent();if(n.setStart(r,o),a)return n.collapse(E),void 0}var s=n.endContainer,d=n.endOffset;t||a||!s[0]||s[0].nodeType!==g.NodeType.TEXT_NODE||(d?d>=s[0].nodeValue.length?(d=s._4eIndex()+1,s=s.parent()):(s._4eSplitText(d),d=s._4eIndex()+1,s=s.parent()):(d=s._4eIndex(),s=s.parent()),n.setEnd(s,d))},insertNode:function(e){var t=this;t.optimizeBookmark(),t.trim(T,E);var n=t.startContainer,r=t.startOffset,o=n[0].childNodes[r]||null;n[0].insertBefore(e[0],o),n[0]===t.endContainer[0]&&t.endOffset++,t.setStartBefore(e)},moveToBookmark:function(e){var t=this,n=k(t.document);if(e.is2){var r=n._4eGetByAddress(e.start,e.normalized),o=e.startOffset,a=e.end&&n._4eGetByAddress(e.end,e.normalized),i=e.endOffset;t.setStart(r,o),a?t.setEnd(a,i):t.collapse(E)}else{var s=e.serializable,d=s?k("#"+e.startNode,n):e.startNode,l=s?k("#"+e.endNode,n):e.endNode;t.setStartBefore(d),d._4eRemove(),l&&l[0]?(t.setEndBefore(l),l._4eRemove()):t.collapse(E)}},getCommonAncestor:function(e,t){var n,r=this,o=r.startContainer,a=r.endContainer;return n=o[0]===a[0]?e&&o[0].nodeType===g.NodeType.ELEMENT_NODE&&r.startOffset===r.endOffset-1?k(o[0].childNodes[r.startOffset]):o:o._4eCommonAncestor(a),t&&n[0].nodeType===g.NodeType.TEXT_NODE?n.parent():n},enlarge:function(){function e(e,t,n,r){var o,a,i=e[t?"startContainer":"endContainer"],s=t?0:1,d=0,l=t?"previousSibling":"nextSibling",c=e[t?"startOffset":"endOffset"];if(i[0].nodeType===g.NodeType.TEXT_NODE){if(t){if(c)return}else if(c<i[0].nodeValue.length)return;a=i[0][l],o=i[0].parentNode}else a=i[0].childNodes[c+(t?-1:1)]||null,o=i[0];for(;o;){for(;a&&(L(a)||D(a));)a=a[l];if(a)return d||e[t?"setStartAfter":"setEndBefore"](k(a)),void 0;if(o=k(o),"body"===o.nodeName())return;d||o.equals(r)?(n[s]=o,d=1):e[t?"setStartBefore":"setEndAfter"](o),a=o[0][l],o=o[0].parentNode}}return function(t){var n,r=this;switch(t){case h.ENLARGE_ELEMENT:if(r.collapsed)return;var o=r.getCommonAncestor(),a=[];if(e(r,1,a,o),e(r,0,a,o),a[0]&&a[1]){var s=a[0].contains(a[1])?a[1]:a[0];r.setStartBefore(s),r.setEndAfter(s)}break;case h.ENLARGE_BLOCK_CONTENTS:case h.ENLARGE_LIST_ITEM_CONTENTS:var d=new i(r.document),l=k(r.document.body);d.setStartAt(l,h.POSITION_AFTER_START),d.setEnd(r.startContainer,r.startOffset);var u,f,m=new c(d),p=c.blockBoundary(t===h.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:N),v=function(e){var t=p(e);return t||(u=k(e)),t},E=function(e){var t=v(e);return t||"br"!==g.nodeName(e)||(f=k(e)),t};m.guard=v,n=m.lastBackward(),u=u||l,r.setStartAt(u,"br"!==u.nodeName()&&(!n&&r.checkStartOfBlock()||n&&u.contains(n))?h.POSITION_AFTER_START:h.POSITION_AFTER_END),d=r.clone(),d.collapse(),d.setEndAt(l,h.POSITION_BEFORE_END),m=new c(d),m.guard=t===h.ENLARGE_LIST_ITEM_CONTENTS?E:v,u=N,n=m.lastForward(),u=u||l,r.setEndAt(u,!n&&r.checkEndOfBlock()||n&&u.contains(n)?h.POSITION_BEFORE_END:h.POSITION_BEFORE_START),f&&r.setEndAfter(f)}}}(),checkStartOfBlock:function(){var e=this,t=e.startContainer,n=e.startOffset;if(n&&t[0].nodeType===g.NodeType.TEXT_NODE){var o=v.trim(t[0].nodeValue.substring(0,n));if(o.length)return T}e.trim();var a=new p(e.startContainer),i=e.clone();i.collapse(E),i.setStartAt(a.block||a.blockLimit,h.POSITION_AFTER_START);var s=new c(i);return s.evaluator=r(E),s.checkBackward()},checkEndOfBlock:function(){var e=this,t=e.endContainer,n=e.endOffset;if(t[0].nodeType===g.NodeType.TEXT_NODE){var o=v.trim(t[0].nodeValue.substring(n));if(o.length)return T}e.trim();var a=new p(e.endContainer),i=e.clone();i.collapse(T),i.setEndAt(a.block||a.blockLimit,h.POSITION_BEFORE_END);var s=new c(i);return s.evaluator=r(T),s.checkForward()},checkBoundaryOfElement:function(e,n){var r=this.clone();r[n===h.START?"setStartAt":"setEndAt"](e,n===h.START?h.POSITION_AFTER_START:h.POSITION_BEFORE_END);var o=new c(r);return o.evaluator=t,o[n===h.START?"checkBackward":"checkForward"]()},getBoundaryNodes:function(){var e,t=this,n=t.startContainer,r=t.endContainer,o=t.startOffset,a=t.endOffset;if(n[0].nodeType===g.NodeType.ELEMENT_NODE)if(e=n[0].childNodes.length,e>o)n=k(n[0].childNodes[o]);else if(0===e)n=n._4ePreviousSourceNode();else{for(n=n[0];n.lastChild;)n=n.lastChild;n=k(n),n=n._4eNextSourceNode()||n}if(r[0].nodeType===g.NodeType.ELEMENT_NODE)if(e=r[0].childNodes.length,e>a)r=k(r[0].childNodes[a])._4ePreviousSourceNode(E);else if(0===e)r=r._4ePreviousSourceNode();else{for(r=r[0];r.lastChild;)r=r.lastChild;r=k(r)}return n._4ePosition(r)&_.POSITION_FOLLOWING&&(n=r),{startNode:n,endNode:r}},fixBlock:function(e,t){var n=this,r=n.createBookmark(),o=k(n.document.createElement(t));return n.collapse(e),n.enlarge(h.ENLARGE_BLOCK_CONTENTS),o[0].appendChild(n.extractContents()),o._4eTrim(),y.ie||o._4eAppendBogus(),n.insertNode(o),n.moveToBookmark(r),o},splitBlock:function(e){var t=this,n=new p(t.startContainer),r=new p(t.endContainer),o=n.blockLimit,a=r.blockLimit,i=n.block,s=r.block,d=N;if(!o.equals(a))return N;"br"!==e&&(i||(i=t.fixBlock(E,e),s=new p(t.endContainer).block),s||(s=t.fixBlock(T,e)));var l=i&&t.checkStartOfBlock(),c=s&&t.checkEndOfBlock();return t.deleteContents(),i&&i[0]===s[0]&&(c?(d=new p(t.startContainer),t.moveToPosition(s,h.POSITION_AFTER_END),s=N):l?(d=new p(t.startContainer),t.moveToPosition(i,h.POSITION_BEFORE_START),i=N):(s=t.splitElement(i),y.ie||v.inArray(i.nodeName(),["ul","ol"])||i._4eAppendBogus())),{previousBlock:i,nextBlock:s,wasStartOfBlock:l,wasEndOfBlock:c,elementPath:d}},splitElement:function(e){var t=this;if(!t.collapsed)return N;t.setEndAt(e,h.POSITION_BEFORE_END);var n=t.extractContents(),r=e.clone(T);return r[0].appendChild(n),r.insertAfter(e),t.moveToPosition(e,h.POSITION_AFTER_END),r},moveToElementEditablePosition:function(e,t){function r(e,r){var o;return e[0].nodeType===g.NodeType.ELEMENT_NODE&&e._4eIsEditable()&&(o=e[t?"last":"first"](n,1)),r||o||(o=e[t?"prev":"next"](n,1)),o}for(var o=0,a=this;e;){if(e[0].nodeType===g.NodeType.TEXT_NODE){a.moveToPosition(e,t?h.POSITION_AFTER_END:h.POSITION_BEFORE_START),o=1;break}e[0].nodeType===g.NodeType.ELEMENT_NODE&&e._4eIsEditable()&&(a.moveToPosition(e,t?h.POSITION_BEFORE_END:h.POSITION_AFTER_START),o=1),e=r(e,o)}return!!o},selectNodeContents:function(e){var t=this,n=e[0];t.setStart(e,0),t.setEnd(e,n.nodeType===g.NodeType.TEXT_NODE?n.nodeValue.length:n.childNodes.length)},insertNodeByDtd:function(e){var t,n,r,o=this,a=e.nodeName(),i=O.$block[a];if(o.deleteContents(),i){for(t=o.getCommonAncestor(T,E);(n=O[t.nodeName()])&&(!n||!n[a]);){var s=t.parent();o.checkStartOfBlock()&&o.checkEndOfBlock()?(o.setStartBefore(t),o.collapse(E),t.remove()):r=t,t=s}r&&o.splitElement(r)}o.insertNode(e)}}),s.injectDom({_4eBreakParent:function(e,t){t=k(t),e=k(e);var n,r=m.Range,o=new r(e[0].ownerDocument);o.setStartAfter(e),o.setEndAfter(t),n=o.extractContents(),o.insertNode(e.remove()),e.after(n)}}),m.Range=i,e=i}(),E=function(e){function t(e){var t=this;if(t.document=e,t._={cache:{}},N)try{var n=t.getNative().createRange();(!n||n.item&&n.item(0).ownerDocument!==e||n.parentElement&&n.parentElement().ownerDocument!==e)&&(t.isInvalid=l)}catch(r){t.isInvalid=l}}function n(e){var n=new t(e);return!n||n.isInvalid?f:n}var r=C,o=b,a=u,i=v,s=d;s.SelectionType={SELECTION_NONE:1,SELECTION_TEXT:2,SELECTION_ELEMENT:3};var l=!0,c=!1,f=null,m=S,p=R,E=s.SelectionType,T=s.RangeType,N=document.selection,h={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};r.augment(t,{getNative:N?function(){var e=this,t=e._.cache;return t.nativeSel||(t.nativeSel=e.document.selection)}:function(){var e=this,t=e._.cache;return t.nativeSel||(t.nativeSel=p.getWindow(e.document).getSelection())},getType:N?function(){var e=this,t=e._.cache;if(t.type)return t.type;var n=E.SELECTION_NONE;try{var r=e.getNative(),o=r.type;"Text"===o&&(n=E.SELECTION_TEXT),"Control"===o&&(n=E.SELECTION_ELEMENT),r.createRange().parentElement&&(n=E.SELECTION_TEXT)}catch(a){}return t.type=n,n}:function(){var e=this,t=e._.cache;if(t.type)return t.type;var n=E.SELECTION_TEXT,r=e.getNative();if(r){if(1===r.rangeCount){var o=r.getRangeAt(0),a=o.startContainer;a===o.endContainer&&a.nodeType===p.NodeType.ELEMENT_NODE&&1===Number(o.endOffset-o.startOffset)&&h[a.childNodes[o.startOffset].nodeName.toLowerCase()]&&(n=E.SELECTION_ELEMENT)}}else n=E.SELECTION_NONE;return t.type=n,n},getRanges:N?function(){var e=function(e,t){e=e.duplicate(),e.collapse(t);for(var n,r=e.parentElement(),o=r.childNodes,a=0;a<o.length;a++){var i=o[a];if(i.nodeType===p.NodeType.ELEMENT_NODE){n=e.duplicate(),n.moveToElementText(i);var s=n.compareEndPoints("StartToStart",e),d=n.compareEndPoints("EndToStart",e);if(n.collapse(),s>0)break;if(!s||1===d&&-1===s)return{container:r,offset:a};if(!d)return{container:r,offset:a+1};n=f}}n||(n=e.duplicate(),n.moveToElementText(r),n.collapse(c)),n.setEndPoint("StartToStart",e);var l=String(n.text).replace(/\r\n|\r/g,"\n").length;try{for(;l>0;)l-=o[--a].nodeValue.length}catch(u){l=0}return 0===l?{container:r,offset:a}:{container:o[a],offset:-l}};return function(t){var n=this,r=n._.cache;if(r.ranges&&!t)return r.ranges;var a,s=n.getNative(),d=s&&s.createRange(),c=n.getType();if(!s)return[];if(c===E.SELECTION_TEXT){a=new i(n.document);var u=e(d,l);return a.setStart(o(u.container),u.offset),u=e(d),a.setEnd(o(u.container),u.offset),r.ranges=[a],[a]}if(c===E.SELECTION_ELEMENT){for(var f=r.ranges=[],m=0;m<d.length;m++){var p=d.item(m),v=p.parentNode,T=0;for(a=new i(n.document);T<v.childNodes.length&&v.childNodes[T]!==p;T++);a.setStart(o(v),T),a.setEnd(o(v),T+1),f.push(a)}return f}return r.ranges=[],[]}}():function(e){var t=this,n=t._.cache;if(n.ranges&&!e)return n.ranges;var r=[],a=t.getNative();if(!a)return[];for(var s=0;s<a.rangeCount;s++){var d=a.getRangeAt(s),l=new i(t.document);l.setStart(o(d.startContainer),d.startOffset),l.setEnd(o(d.endContainer),d.endOffset),r.push(l)}return n.ranges=r,r},getStartElement:function(){var e=this,t=e._.cache;if(void 0!==t.startElement)return t.startElement;var n,r=e.getNative();switch(e.getType()){case E.SELECTION_ELEMENT:return this.getSelectedElement();case E.SELECTION_TEXT:var a=e.getRanges()[0];if(a&&!a.collapsed){for(a.optimize();l;){var i=a.startContainer,s=a.startOffset;if(s!==(i[0].nodeType===p.NodeType.ELEMENT_NODE?i[0].childNodes.length:i[0].nodeValue.length)||i._4eIsBlockBoundary())break;a.setStartAfter(i)}if(n=a.startContainer,n[0].nodeType!==p.NodeType.ELEMENT_NODE)return n.parent();if(n=o(n[0].childNodes[a.startOffset]),!n[0]||n[0].nodeType!==p.NodeType.ELEMENT_NODE)return a.startContainer;for(var d=n[0].firstChild;d&&d.nodeType===p.NodeType.ELEMENT_NODE;)n=o(d),d=d.firstChild;return n}N?(a=r.createRange(),a.collapse(l),n=o(a.parentElement())):(n=r.anchorNode,n&&n.nodeType!==p.NodeType.ELEMENT_NODE&&(n=n.parentNode),n&&(n=o(n)))}return t.startElement=n,n},getSelectedElement:function(){var e,t=this,n=t._.cache;if(void 0!==n.selectedElement)return n.selectedElement;if(N){var r=t.getNative().createRange();e=r.item&&r.item(0)}return e=e?o(e):function(){for(var e,n,r=t.getRanges()[0],o=2;o&&!((e=r.getEnclosedNode())&&e[0].nodeType===p.NodeType.ELEMENT_NODE&&h[e.nodeName()]&&(n=e));o--)r.shrink(T.SHRINK_ELEMENT);return n}(),n.selectedElement=e,e},reset:function(){this._.cache={}},selectElement:function(e){var t,n=this,r=n.document;if(N){try{t=r.body.createControlRange(),t.addElement(e[0]),t.select()}catch(o){t=r.body.createTextRange(),t.moveToElementText(e[0]),t.select()}finally{}n.reset()}else{t=r.createRange(),t.selectNode(e[0]);var a=n.getNative();a.removeAllRanges(),a.addRange(t),n.reset()}},selectRanges:function(e){var t=this;if(N){if(e.length>1){var n=e[e.length-1];e[0].setEnd(n.endContainer,n.endOffset),e.length=1}e[0]&&e[0].select(),t.reset()}else{var r=t.getNative();if(!r)return;r.removeAllRanges();for(var o=0;o<e.length;o++){var a=e[o],i=t.document.createRange(),s=a.startContainer;a.collapsed&&(m.gecko&&m.gecko<1.09||m.webkit)&&s[0].nodeType===p.NodeType.ELEMENT_NODE&&!s[0].childNodes.length&&(s[0].appendChild(t.document.createTextNode(m.webkit?"â":"")),a.startOffset++,a.endOffset++),i.setStart(s[0],a.startOffset),i.setEnd(a.endContainer[0],a.endOffset),r.addRange(i)}t.reset()}},createBookmarks2:function(e){for(var t=[],n=this.getRanges(),r=0;r<n.length;r++)t.push(n[r].createBookmark2(e));return t},createBookmarks:function(e,t){var n,r=this,a=[],i=r.document;t=t||r.getRanges();for(var s=t.length,d=0;s>d;d++){a.push(n=t[d].createBookmark(e,l)),e=n.serializable;for(var c=e?o("#"+n.startNode,i):n.startNode,u=e?o("#"+n.endNode,i):n.endNode,f=d+1;s>f;f++){var m=t[f],v=m.startContainer,E=m.endContainer;p.equals(v,c.parent())&&m.startOffset++,p.equals(v,u.parent())&&m.startOffset++,p.equals(E,c.parent())&&m.endOffset++,p.equals(E,u.parent())&&m.endOffset++}}return a},selectBookmarks:function(e){for(var t=this,n=[],r=0;r<e.length;r++){var o=new i(t.document);o.moveToBookmark(e[r]),n.push(o)}return t.selectRanges(n),t},getCommonAncestor:function(){var e=this.getRanges(),t=e[0].startContainer,n=e[e.length-1].endContainer;return t._4eCommonAncestor(n)},scrollIntoView:function(){var e=this.getStartElement();e&&e.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0})},removeAllRanges:function(){var e=this.getNative();N?e&&e.clear():e&&e.removeAllRanges()}});var _={table:1,tbody:1,tr:1},g=a.whitespaces(l),y=/\ufeff|\u00a0/;return i.prototype.select=N?function(e){var n,r,a=this,i=a.collapsed;if(a.startContainer[0]===a.endContainer[0]&&a.endOffset-a.startOffset===1){var s=a.startContainer[0].childNodes[a.startOffset];if(s.nodeType===p.NodeType.ELEMENT_NODE)return new t(a.document).selectElement(o(s)),void 0}(a.startContainer[0].nodeType===p.NodeType.ELEMENT_NODE&&a.startContainer.nodeName()in _||a.endContainer[0].nodeType===p.NodeType.ELEMENT_NODE&&a.endContainer.nodeName()in _)&&a.shrink(T.SHRINK_ELEMENT,l);var d,c=a.createBookmark(),u=c.startNode;i||(d=c.endNode);var f=a.document.body.createTextRange();if(f.moveToElementText(u[0]),f.moveStart("character",1),d){var m=a.document.body.createTextRange();m.moveToElementText(d[0]),f.setEndPoint("EndToEnd",m),f.moveEnd("character",-1)}else{for(var v=u[0].nextSibling;v&&!g(v);)v=v.nextSibling;n=!(v&&v.nodeValue&&v.nodeValue.match(y))&&(e||!u[0].previousSibling||u[0].previousSibling&&"br"===p.nodeName(u[0].previousSibling)),r=o(a.document.createElement("span")),r.html("&#65279;"),r.insertBefore(u),n&&p.insertBefore(a.document.createTextNode("ï»¿"),u[0]||u)}a.setStartBefore(u),u._4eRemove(),i?(n?(f.moveStart("character",-1),f.select(),a.document.selection.clear()):f.select(),r&&(a.moveToPosition(r,T.POSITION_BEFORE_START),r._4eRemove())):(a.setEndBefore(d),d._4eRemove(),f.select())}:function(){var e=this,t=e.startContainer;e.collapsed&&t[0].nodeType===p.NodeType.ELEMENT_NODE&&!t[0].childNodes.length&&(t[0].appendChild(e.document.createTextNode(m.webkit?"â":"")),e.startOffset++,e.endOffset++);var r=e.document.createRange();r.setStart(t[0],e.startOffset);try{r.setEnd(e.endContainer[0],e.endOffset)}catch(o){if(!(o.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0))throw o;e.collapse(l),r.setEnd(e.endContainer[0],e.endOffset)}var a=n(e.document).getNative();a.removeAllRanges(),a.addRange(r)},t.getSelection=n,s.Selection=t,e=t}(),T=function(e){function t(e){function t(e,t){var n=d.body.createTextRange();try{n.moveToPoint(e,t)}catch(r){n=c}return n}function n(){var e=d.selection.createRange();a&&!e.item&&0===e.compareEndPoints("StartToEnd",e)&&a.select(),s.detach("mouseup",n),s.detach("mousemove",r),a=o=0}function r(e){var r;e.button?(r=t(e.pageX,e.pageY),r&&(r.compareEndPoints("StartToStart",a)>0?r.setEndPoint("StartToStart",a):r.setEndPoint("EndToEnd",a),r.select())):n()}var o,a,i=e.get("window")[0],s=e.get("document"),d=s[0];s.on("mousedown contextmenu",function(e){var l=d.documentElement;if(e.target===l){if(o&&n(),l.scrollHeight>l.clientHeight)return;o=1,a=t(e.pageX,e.pageY),a&&(s.on("mouseup",n),s.on("mousemove",r),i.focus(),a.select())}})}function n(e){function t(r){if(d){var o=e.getSelection(),i=o&&o.getType(),l=o&&n.selection;if(r&&l&&i===m.SELECTION_NONE&&!n.queryCommandEnabled("InsertImage"))return setTimeout(function(){t(s)},50),void 0;var c;if(l&&l.type&&"Control"!==l.type&&(c=l.createRange())&&(c=c.parentElement())&&(c=c.nodeName)&&c.toLowerCase()in{input:1,textarea:1})return;a=l&&o.getRanges()[0],e.checkSelectionChange()}}var n=e.get("document")[0],r=i(n.body),o=i(n.documentElement);u.ieMode<8&&o.on("click",function(t){var n=i(t.target);"html"===n.nodeName()&&e.getSelection().getNative().createRange().select()});var a,d,f=s;o.on("mousedown",function(){f=l}),o.on("mouseup",function(){f=s}),r.on("focusin",function(e){var t=i(e.target);if("body"===t.nodeName()&&a){try{f&&a.select()}catch(n){}a=c}}),r.on("focus",function(){d=s,t()}),r.on("beforedeactivate",function(e){e.relatedTarget||(d=l,f=s)}),r.on("mousedown",function(){d=l}),r.on("mouseup",function(){d=s,setTimeout(function(){t(s)},0)}),r.on("keydown",function(){d=l}),r.on("keyup",function(){d=s,setTimeout(function(){t()},0)})}function r(e){function t(){e.checkSelectionChange()}e.get("document").on("mouseup keyup selectionchange",t)}function o(e){function t(e){return e.outerHtml().match(o)}function n(e){var t=a.XHTML_DTD;return e._4eIsBlockBoundary()&&t.$empty[e.nodeName()]}function r(e){return d(e)&&c(e)}var o=/\s*<(p|div|address|h\d|center)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;|(<!--[\s\S]*?-->))?\s*(:?<\/\1>)?(?=\s*$|<\/body>)/gi,d=a.Walker.whitespaces(s),c=a.Walker.bookmark(l,s),m=function(e){return d(e)&&8!==e.nodeType};e.on("selectionChange",function(o){var d=o.path,c=e.get("document")[0],p=i(c.body),v=o.selection,E=v&&v.getRanges()[0],T=d.blockLimit;if(p[0]||(c.documentElement.appendChild(c.createElement("body")),p=i(c.body),E&&(E.setStart(p,0),E.collapse(1))),T=T||p,u.gecko){var N=d.block||d.blockLimit,h=N&&N.last(r);!N||!N._4eIsBlockBoundary()||h&&1===h[0].nodeType&&h._4eIsBlockBoundary()||"pre"===N.nodeName()||N._4eGetBogus()||N._4eAppendBogus()}if(E&&E.collapsed&&!d.block){if("body"===T.nodeName()){"html"===E.startContainer.nodeName()&&E.setStart(p,0);var _=E.fixBlock(s,"p");if(_&&_[0]!==p[0].lastChild&&t(_)){var g=_.next(m,1);g&&g[0].nodeType===f.NodeType.ELEMENT_NODE&&!n[g]?(E.moveToElementEditablePosition(g),_._4eRemove()):(g=_.prev(m,1),g&&g[0].nodeType===f.NodeType.ELEMENT_NODE&&!n[g]&&(E.moveToElementEditablePosition(g,t(g)?l:s),_._4eRemove()))}E.select(),e.notifySelectionChange()}var y,O,S=e.get("document")[0],b=new a.Range(S);b.moveToElementEditablePosition(p,s),y=new a.ElementPath(b.startContainer),"body"!==y.blockLimit.nodeName()&&(O=i(S.createElement("p")).appendTo(p),u.ie||O._4eAppendBogus())}})}e={};var a=d,i=b,s=!0,l=!1,c=null,u=S,f=R,m=a.SelectionType;return e.init=function(e){e.docReady(function(){if(document.selection)t(e),n(e);else if(r(e),u.ie){var o,a=e.get("document");a.on("focusout",function(){o=e.getSelection().getRanges()}),a.on("focusin",function(){if(o){var t=e.getSelection();t.selectRanges(o),o=null}})}}),o(e)},e}(),N=function(e){function t(e){return!q.attr(e,"_ke_bookmark")}function n(e,t){for(var r in e)"string"==typeof e[r]?e[r]=e[r].replace(Z,function(e,n){return t[n]}):n(e[r],t)}function r(e,t){t&&(e=B.clone(e),n(e,t));var r=this.element=this.element=(e.element||"*").toLowerCase();this.type=this.type="#text"===r||z[r]?A.STYLE_BLOCK:j[r]?A.STYLE_OBJECT:A.STYLE_INLINE,this._={definition:e}}function o(e,t){var n=this,r=t?n.removeFromRange:n.applyToRange;e.body.focus();for(var o=new P(e),a=o.getRanges(),i=0;i<a.length;i++)r.call(n,a[i]);o.selectRanges(a)}function a(e,t,n){var r,o=e.element;return"*"===o&&(o="span"),r=G(t.createElement(o)),n&&n._4eCopyAttributes(r),i(r,e)}function i(e,t){var n=t._.definition,o=n.attributes,a=r.getStyleText(n);if(o)for(var i in o)e.attr(i,o[i]);return a&&(e[0].style.cssText=a),e}function s(e){var t=e.createBookmark(H),n=e.createIterator();n.enforceRealBlocks=H,n.enlargeBr=H;for(var r,o=e.document;r=n.getNextParagraph();){var i=a(this,o,r);m(r,i)}e.moveToBookmark(t)}function l(e,t,n){var r="",o="";return e=e.replace(/(^<span[^>]+_ke_bookmark.*?\/span>)|(<span[^>]+_ke_bookmark.*?\/span>$)/gi,function(e,t,n){return t&&(r=t),n&&(o=n),""}),r+e.replace(t,n)+o}function c(e,t){var n=e.html();if(n=l(n,/(?:^[\t\n\r]+)|(?:[\t\n\r]+$)/g,""),n=n.replace(/[\t\r\n]*(<br[^>]*>)[\t\r\n]*/gi,"$1"),n=n.replace(/([\t\n\r]+|&nbsp;)/g," "),n=n.replace(/<br\b[^>]*>/gi,"\n"),K.ie){var r=e[0].ownerDocument.createElement("div");r.appendChild(t[0]),t.outerHtml("<pre>"+n+"</pre>"),t=G(r.firstChild),t._4eRemove()}else t.html(n);return t}function u(e){var t=/(\S\s*)\n(?:\s|(<span[^>]+_ck_bookmark.*?\/span>))*\n(?!$)/gi,n=l(e.outerHtml(),t,function(e,t,n){return t+"</pre>"+n+"<pre>"}),r=[];return n.replace(/<pre\b.*?>([\s\S]*?)<\/pre>/gi,function(e,t){r.push(t)}),r}function m(e,t){var n="pre"===t.nodeName,r="pre"===e.nodeName,o=n&&!r,a=!n&&r;o?t=c(e,t):a?t=T(u(e),t):e._4eMoveChildren(t),e[0].parentNode.replaceChild(t[0],e[0]),n&&p(t)}function p(e){var t;if((t=e._4ePreviousSourceNode(H,q.NodeType.ELEMENT_NODE))&&"pre"===t.nodeName()){var n=l(t.html(),/\n$/,"")+"\n\n"+l(e.html(),/^\n/,"");K.ie?e.outerHtml("<pre>"+n+"</pre>"):e.html(n),t._4eRemove()}}function T(e,t){for(var n=t[0].ownerDocument.createDocumentFragment(),r=0;r<e.length;r++){var o=e[r];o=o.replace(/(\r\n|\r)/g,"\n"),o=l(o,/^[\t]*\n/,""),o=l(o,/\n$/,""),o=l(o,/^[\t]+|[\t]+$/g,function(e,t){return 1===e.length?"&nbsp;":t?" "+new Array(e.length).join("&nbsp;"):new Array(e.length).join("&nbsp;")+" "}),o=o.replace(/\n/g,"<br>"),o=o.replace(/[\t]{2,}/g,function(e){return new Array(e.length).join("&nbsp;")+" "});var a=t.clone();a.html(o),n.appendChild(a[0])}return n}function N(e){var n=this,r=e.document;if(e.collapsed){var o=a(this,r,void 0);return e.insertNode(o),e.moveToPosition(o,U.POSITION_BEFORE_END),void 0}var i,s=this.element,d=this._.definition,l=Y[s];l||(i=H,l=Y.span);var c=e.createBookmark();e.enlarge(U.ENLARGE_ELEMENT),e.trim();for(var u,f=e.createBookmark(),m=f.startNode,p=f.endNode,v=m;v&&v[0];){var E=$;if(q.equals(v,p))v=V,E=H;else{var T=v[0].nodeType,N=T===q.NodeType.ELEMENT_NODE?v.nodeName():V;if(N&&v.attr("_ke_bookmark")){v=v._4eNextSourceNode(H);continue}if(!N||l[N]&&(v._4ePosition(p)|(W.POSITION_PRECEDING|W.POSITION_IDENTICAL|W.POSITION_IS_CONTAINED))===W.POSITION_PRECEDING+W.POSITION_IDENTICAL+W.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(v))){var h=v.parent();if(h&&"a"===s&&h.nodeName()===s){var _=a(n,r,void 0);h._4eMoveChildren(_),h[0].parentNode.replaceChild(_[0],h[0]),_._4eMergeSiblings()}else if(h&&h[0]&&((Y[h.nodeName()]||Y.span)[s]||i)&&(!d.parentRule||d.parentRule(h))){if(u||N&&Y.$removeEmpty[N]&&(v._4ePosition(p)|(W.POSITION_PRECEDING|W.POSITION_IDENTICAL|W.POSITION_IS_CONTAINED))!==W.POSITION_PRECEDING+W.POSITION_IDENTICAL+W.POSITION_IS_CONTAINED||(u=new M(r),u.setStartBefore(v)),T===q.NodeType.TEXT_NODE||T===q.NodeType.ELEMENT_NODE&&!v[0].childNodes.length){for(var g=v,y=null;(E=!g.next(t,1))&&(y=g.parent())&&l[y.nodeName()]&&(y._4ePosition(m)|W.POSITION_FOLLOWING|W.POSITION_IDENTICAL|W.POSITION_IS_CONTAINED)===W.POSITION_FOLLOWING+W.POSITION_IDENTICAL+W.POSITION_IS_CONTAINED&&(!d.childRule||d.childRule(y));)g=y;u.setEndAfter(g)}}else E=H}else E=H;v=v._4eNextSourceNode()}if(E&&u&&!u.collapsed){for(var O,S,b=a(n,r,void 0),C=u.getCommonAncestor(),k={styles:{},attrs:{},blockedStyles:{},blockedAttrs:{}},I=null;b&&C&&b[0]&&C[0];){if(C.nodeName()===s){for(O in d.attributes)!k.blockedAttrs[O]&&(S=C.attr(I))&&(b.attr(O)===S?b.removeAttr(O):k.blockedAttrs[O]=1);for(I in d.styles)!k.blockedStyles[I]&&(S=C.style(I))&&(b.style(I)===S?b.style(I,""):k.blockedStyles[I]=1);if(!b._4eHasAttributes()){b=V;break}}C=C.parent()}b?(b[0].appendChild(u.extractContents()),L(n,b),u.insertNode(b),b._4eMergeSiblings(),K.ie||b[0].normalize()):(b=G(r.createElement("span")),b[0].appendChild(u.extractContents()),u.insertNode(b),L(n,b),b._4eRemove(!0)),u=V}}m._4eRemove(),p._4eRemove(),e.moveToBookmark(c),e.shrink(U.SHRINK_TEXT)}function h(e){e.enlarge(U.ENLARGE_ELEMENT);var t=e.createBookmark(),n=t.startNode;if(e.collapsed){for(var r,o,a=new X(n.parent()),i=0;i<a.elements.length&&(o=a.elements[i])&&(!o.equals(a.block)&&!o.equals(a.blockLimit));i++)if(this.checkElementRemovable(o)){var s=e.checkBoundaryOfElement(o,U.END),d=!s&&e.checkBoundaryOfElement(o,U.START);if(d||s)r=o,r.match=d?"start":"end";else if(o._4eMergeSiblings(),o.nodeName()!==this.element){var l=k(this);D(o,l[o.nodeName()]||l["*"])}else I(this,o)}if(r){var c=n;for(i=0;;i++){var u=a.elements[i];if(u.equals(r))break;u.match||(u=u.clone(),u[0].appendChild(c[0]),c=u)}c["start"===r.match?"insertBefore":"insertAfter"](r);var f=r.html();f&&"â"!==f?K.webkit&&G(e.document.createTextNode("â")).insertBefore(c):r.remove()}}else{var m=t.endNode,p=this,v=function(){for(var e,t=new X(n.parent()),r=new X(m.parent()),o=V,a=V,i=0;i<t.elements.length&&(e=t.elements[i],e!==t.block&&e!==t.blockLimit);i++)p.checkElementRemovable(e)&&(o=e);for(i=0;i<r.elements.length&&(e=r.elements[i],e!==r.block&&e!==r.blockLimit);i++)p.checkElementRemovable(e)&&(a=e);a&&m._4eBreakParent(a),o&&n._4eBreakParent(o)};v();for(var E=G(n[0].nextSibling);E[0]!==m[0];){var T=E._4eNextSourceNode();if(E[0]&&E[0].nodeType===q.NodeType.ELEMENT_NODE&&this.checkElementRemovable(E)){if(E.nodeName()===this.element)I(this,E);else{var N=k(this);D(E,N[E.nodeName()]||N["*"])}T[0].nodeType===q.NodeType.ELEMENT_NODE&&T.contains(n)&&(v(),T=G(n[0].nextSibling))}E=T}}e.moveToBookmark(t)}function _(e){e=String(e);var t={};return e.replace(/&quot;/g,'"').replace(/\s*([^ :;]+)\s*:\s*([^;]+)\s*(?=;|$)/g,function(e,n,r){t[n]=r}),t}function g(e,t){"string"==typeof e&&(e=_(e)),"string"==typeof t&&(t=_(t));for(var n in e)if(!(n in t)||t[n]!==e[n]&&"inherit"!==e[n]&&"inherit"!==t[n])return $;return H}function y(e,t){var n="";if(t!==$){var r=document.createElement("span");r.style.cssText=e,n=r.style.cssText||""}else n=e;return n.replace(/\s*([;:])\s*/,"$1").replace(/([^\s;])$/,"$1;").replace(/,\s+/g,",").toLowerCase()}function O(e){var t=e._AC;if(t)return t;t={};var n=0,o=e.attributes;if(o)for(var a in o)n++,t[a]=o[a];var i=r.getStyleText(e);return i&&(t.style||n++,t.style=i),t._length=n,e._AC=t,t}function k(e){if(e._.overrides)return e._.overrides;var t=e._.overrides={},n=e._.definition.overrides;if(n){B.isArray(n)||(n=[n]);for(var r=0;r<n.length;r++){var o,a,i,s,d=n[r];if("string"==typeof d?o=d.toLowerCase():(o=d.element?d.element.toLowerCase():e.element,i=d.attributes,s=d.styles),a=t[o]||(t[o]={}),i){var l=a.attributes=a.attributes||[];for(var c in i)l.push([c.toLowerCase(),i[c]])}if(s){var u=a.styles=a.styles||[];for(var f in s)u.push([f.toLowerCase(),s[f]])}}}return t}function I(e,t){var n=e._.definition,r=k(e),o=B.merge(n.attributes,(r[t.nodeName()]||r["*"]||{}).attributes),a=B.merge(n.styles,(r[t.nodeName()]||r["*"]||{}).styles),i=B.isEmptyObject(o)&&B.isEmptyObject(a);for(var s in o)("class"!==s&&!e._.definition.fullMatch||t.attr(s)===x(s,o[s]))&&(i=i||!!t.hasAttr(s),t.removeAttr(s));for(var d in a)e._.definition.fullMatch&&t.style(d)!==x(d,a[d],H)||(i=i||!!t.style(d),t.style(d,""));w(t)}function x(e,t,n){var r=G("<span>");return r[n?"style":"attr"](e,t),r[n?"style":"attr"](e)}function L(e,t){for(var n=k(e),r=t.all(e.element),o=r.length;--o>=0;)I(e,G(r[o]));for(var a in n)if(a!==e.element)for(r=t.all(a),o=r.length-1;o>=0;o--){var i=G(r[o]);D(i,n[a])}}function D(e,t){var n,r,o=t&&t.attributes;if(o)for(n=0;n<o.length;n++){var a=o[n][0];if(r=e.attr(a)){var i=o[n][1];(i===V||i.test&&i.test(r)||"string"==typeof i&&r===i)&&e[0].removeAttribute(a)}}var s=t&&t.styles;if(s)for(n=0;n<s.length;n++){var d,l=s[n][0];if(d=e.css(l)){var c=s[n][1];(c===V||c.test&&c.test(r)||"string"==typeof c&&d===c)&&e.css(l,"")}}w(e)}function w(e){if(!e._4eHasAttributes()){var t=e[0].firstChild,n=e[0].lastChild;e._4eRemove(H),t&&(t.nodeType===q.NodeType.ELEMENT_NODE&&q._4eMergeSiblings(t),n&&t!==n&&n.nodeType===q.NodeType.ELEMENT_NODE&&q._4eMergeSiblings(n))}}var A,B=C,P=E,M=v,F=d,X=f,H=!0,$=!1,V=null,G=b,q=R,U=F.RangeType,W=F.PositionType,K=S,z={address:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,p:1,pre:1},Y=F.XHTML_DTD,j={embed:1,hr:1,img:1,li:1,object:1,ol:1,table:1,td:1,tr:1,th:1,ul:1,dl:1,dt:1,dd:1,form:1},J=/\s*(?:;\s*|$)/g,Z=/#\((.+?)\)/g;return F.StyleType=A={STYLE_BLOCK:1,STYLE_INLINE:2,STYLE_OBJECT:3},r.prototype={constructor:r,apply:function(e){o.call(this,e,$)},remove:function(e){o.call(this,e,H)},applyToRange:function(e){var t=this;return(t.applyToRange=this.type===A.STYLE_INLINE?N:t.type===A.STYLE_BLOCK?s:t.type===A.STYLE_OBJECT?V:V).call(t,e)},removeFromRange:function(e){var t=this;return(t.removeFromRange=t.type===A.STYLE_INLINE?h:V).call(t,e)},checkElementRemovable:function(e,t){if(!e)return $;var n,r,o,a=this._.definition;if(e.nodeName()===this.element){if(!t&&!e._4eHasAttributes())return H;if(r=O(a),!r._length)return H;for(n in r)if("_length"!==n){var i=e.attr(n)||"";if("style"===n?g(r[n],y(i,$)):r[n]===i){if(!t)return H}else if(t)return $}if(t)return H}var s,d=k(this),l=d[e.nodeName()]||d["*"];if(l){if(!(r=l.attributes)&&!(o=l.styles))return H;if(r)for(s=0;s<r.length;s++){n=r[s][0];var c=e.attr(n);if(c){var u=r[s][1];if(u===V||"string"==typeof u&&c===u||u.test&&u.test(c))return H}}if(o)for(s=0;s<o.length;s++){var f=o[s][0],m=e.css(f);if(m){var p=o[s][1];if(p===V||"string"==typeof p&&m===p||p.test&&p.test(m))return H}}}return $},checkActive:function(e){switch(this.type){case A.STYLE_BLOCK:return this.checkElementRemovable(e.block||e.blockLimit,H);case A.STYLE_OBJECT:case A.STYLE_INLINE:for(var t,n=e.elements,r=0;r<n.length;r++)if(t=n[r],(this.type!==A.STYLE_INLINE||!q.equals(t,e.block)&&!q.equals(t,e.blockLimit))&&(this.type!==A.STYLE_OBJECT||t.nodeName()in j)&&this.checkElementRemovable(t,H))return H}return $}},r.getStyleText=function(e){var t=e._ST;if(t)return t;t=e.styles;var n=e.attributes&&e.attributes.style||"",r="";n.length&&(n=n.replace(J,";"));for(var o in t){var a=t[o],i=(o+":"+a).replace(J,";");"inherit"===a?r+=i:n+=i}return n.length&&(n=y(n)),n+=r,e._ST=n,n
},F.Style=r,e=r}(),h=function(e){function t(e){if(!(arguments.length<1)){var t=this;t.range=e,t.forceBrBreak=c,t.enlargeBr=l,t.enforceRealBlocks=c,t._=t._||{}}}var n=C,r=b,o=u,a=v,i=d,s=f,l=!0,c=!1,m=null,p=S,E=i.RangeType,T=R,N=/^[\r\n\t ]*$/;return n.augment(t,{getNextParagraph:function(e){var t,i,d,u,f,v,h=this;if(!h._.lastNode){d=h.range.clone(),d.shrink(E.SHRINK_ELEMENT,l),d.enlarge(h.forceBrBreak||!h.enlargeBr?E.ENLARGE_LIST_ITEM_CONTENTS:E.ENLARGE_BLOCK_CONTENTS);var _=new o(d),g=o.bookmark(l,l);if(_.evaluator=g,h._.nextNode=_.next(),_=new o(d),_.evaluator=g,i=_.previous(),h._.lastNode=i._4eNextSourceNode(l),h._.lastNode&&h._.lastNode[0].nodeType===T.NodeType.TEXT_NODE&&!n.trim(h._.lastNode[0].nodeValue)&&h._.lastNode.parent()._4eIsBlockBoundary()){var y=new a(d.document);if(y.moveToPosition(h._.lastNode,E.POSITION_AFTER_END),y.checkEndOfBlock()){var O=new s(y.endContainer),S=O.block||O.blockLimit;h._.lastNode=S._4eNextSourceNode(l)}}h._.lastNode||(h._.lastNode=h._.docEndMarker=r(d.document.createTextNode("")),T.insertAfter(h._.lastNode[0],i[0])),d=m}var b=h._.nextNode;for(i=h._.lastNode,h._.nextNode=m;b;){var C=c,k=b[0].nodeType!==T.NodeType.ELEMENT_NODE,I=c;if(k)b[0].nodeType===T.NodeType.TEXT_NODE&&N.test(b[0].nodeValue)&&(k=c);else{var R=b.nodeName(),x=h.forceBrBreak&&{br:1};if(b._4eIsBlockBoundary(x)){if("br"===R)k=l;else if(!d&&!b[0].childNodes.length&&"hr"!==R){t=b,u=b.equals(i);break}d&&(d.setEndAt(b,E.POSITION_BEFORE_START),"br"!==R&&(h._.nextNode=b)),C=l}else{if(b[0].firstChild){d||(d=new a(h.range.document),d.setStartAt(b,E.POSITION_BEFORE_START)),b=r(b[0].firstChild);continue}k=l}}if(k&&!d&&(d=new a(h.range.document),d.setStartAt(b,E.POSITION_BEFORE_START)),u=(!C||k)&&b.equals(i),d&&!C)for(;!b[0].nextSibling&&!u;){var L=b.parent();if(L._4eIsBlockBoundary(h.forceBrBreak&&{br:1})){C=l,u=u||L.equals(i);break}b=L,k=l,u=b.equals(i),I=l}if(k&&d.setEndAt(b,E.POSITION_AFTER_END),b=b._4eNextSourceNode(I,m,i),u=!b,u||C&&d)break}if(!t){if(!d)return h._.docEndMarker&&h._.docEndMarker._4eRemove(),h._.nextNode=m,m;var D=new s(d.startContainer),w=D.blockLimit,A={div:1,th:1,td:1};if(t=D.block,t&&t[0]||h.enforceRealBlocks||!A[w.nodeName()]||!d.checkStartOfBlock()||!d.checkEndOfBlock())if(!t||h.enforceRealBlocks&&"li"===t.nodeName())t=r(h.range.document.createElement(e||"p")),t[0].appendChild(d.extractContents()),t._4eTrim(),d.insertNode(t),f=v=l;else if("li"!==t.nodeName()){if(!d.checkStartOfBlock()||!d.checkEndOfBlock()){t=t.clone(c),t[0].appendChild(d.extractContents()),t._4eTrim();var B=d.splitBlock();f=!B.wasStartOfBlock,v=!B.wasEndOfBlock,d.insertNode(t)}}else u||(h._.nextNode=t.equals(i)?m:d.getBoundaryNodes().endNode._4eNextSourceNode(l,m,i));else t=w}if(f){var P=r(t[0].previousSibling);P[0]&&P[0].nodeType===T.NodeType.ELEMENT_NODE&&("br"===P.nodeName()?P._4eRemove():P[0].lastChild&&"br"===T.nodeName(P[0].lastChild)&&T._4eRemove(P[0].lastChild))}if(v){var M=o.bookmark(c,l),F=r(t[0].lastChild);F[0]&&F[0].nodeType===T.NodeType.ELEMENT_NODE&&"br"===F.nodeName()&&(p.ie||F.prev(M,1)||F.next(M,1))&&F.remove()}return h._.nextNode||(h._.nextNode=u||t.equals(i)?m:t._4eNextSourceNode(l,m,i)),t}}),a.prototype.createIterator=function(){return new t(this)},e=t}(),_=function(t){function n(e,t){var n=e.get("document")[0],r=m(n.body),o=!1,a=function(){o=!0};return r.on(t,a),(p.ieMode>7?n:n.selection.createRange()).execCommand(t),r.detach(t,a),o}function r(e){var t=this;t.editor=e,t._init()}function o(e){var t,n=e.get("document")[0],r=e.getSelection();if(r.getType()===f.SELECTION_ELEMENT&&(t=r.getSelectedElement())){var o=r.getRanges()[0],a=m(n.createTextNode(""));a.insertBefore(t),o.setStartBefore(a),o.setEndAfter(t),r.selectRanges([o]),setTimeout(function(){t.parent()&&(a.remove(),r.selectElement(t))},0)}}function a(e){if(p.webkit){if(!e.match(/^[^<]*$/g)&&!e.match(/^(<div><br( ?\/)?><\/div>|<div>[^<]*<\/div>)*$/gi))return 0}else if(p.ie){if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi)&&!e.match(/^(<p>([^<]|<br( ?\/)?>)*<\/p>|(\r\n))*$/gi))return 0}else{if(!p.gecko)return 0;if(!e.match(/^([^<]|<br( ?\/)?>)*$/gi))return 0}return 1}function i(e){return e=e.replace(/\s+/g," ").replace(/> +</g,"><").replace(/<br ?\/>/gi,"<br>"),e.match(/^[^<]$/)?e:(p.webkit&&e.indexOf("<div>")>-1?(e.match(/<div>(?:<br>)?<\/div>/)&&(e=e.replace(/<div>(?:<br>)?<\/div>/g,function(){return"<p></p>"}),e=e.replace(/<\/p><div>/g,"</p><p>").replace(/<\/div><p>/g,"</p><p>").replace(/^<div>/,"<p>").replace(/^<\/div>/,"</p>")),e.match(/<\/div><div>/)&&(e=e.replace(/<\/div><div>/g,"</p><p>").replace(/^<div>/,"<p>").replace(/^<\/div>/,"</p>"))):p.gecko&&(p.gecko&&(e=e.replace(/^<br><br>$/,"<br>")),e.indexOf("<br><br>")>-1&&(e="<p>"+e.replace(/<br><br>/g,function(){return"</p><p>"})+"</p>")),e)}function s(e){var t=0;return e=e.replace(/<span[^>]+_ke_bookmark[^<]*?<\/span>(&nbsp;)*/gi,""),-1!==e.indexOf("Apple-")&&(e=e.replace(/<span class="Apple-converted-space">&nbsp;<\/span>/gi," "),e=e.replace(/<span class="Apple-tab-span"[^>]*>([^<]*)<\/span>/gi,function(e,t){return t.replace(/\t/g,new Array(5).join("&nbsp;"))}),e.indexOf('<br class="Apple-interchange-newline">')>-1&&(t=1,e=e.replace(/<br class="Apple-interchange-newline">/,"")),e=e.replace(/(<[^>]+) class="Apple-[^"]*"/gi,"$1")),!t&&a(e)&&(e=i(e)),e}t={};var l=C,c=d,u=v,f=E,m=b,p=S,T=p.ieMode<11,N=T?"beforepaste":"paste",h=c.RangeType,_=T?function(e,t){return n(e,t)}:function(e,t){try{return e.get("document")[0].execCommand(t)}catch(n){return!1}},g={cut:"æ¨çæµè§å¨å®å¨è®¾ç½®ä¸åè®¸ç¼è¾å¨èªå¨æ§è¡åªåæä½ï¼è¯·ä½¿ç¨é®çå¿«æ·é®(Ctrl/Cmd+X)æ¥å®æ",copy:"æ¨çæµè§å¨å®å¨è®¾ç½®ä¸åè®¸ç¼è¾å¨èªå¨æ§è¡å¤å¶æä½ï¼è¯·ä½¿ç¨é®çå¿«æ·é®(Ctrl/Cmd+C)æ¥å®æ",paste:"æ¨çæµè§å¨å®å¨è®¾ç½®ä¸åè®¸ç¼è¾å¨èªå¨æ§è¡ç²è´´æä½ï¼è¯·ä½¿ç¨é®çå¿«æ·é®(Ctrl/Cmd+V)æ¥å®æ"};l.augment(r,{_init:function(){var e=this,t=e.editor,n=t.get("document"),r=n.one("body"),a=function(e){this.type=e};a.prototype={exec:function(t){var n=this.type;t.focus(),setTimeout(function(){T&&("cut"===n?o(t):"paste"===n&&(e._preventPasteEvent(),e._getClipboardDataFromPasteBin())),_(t,n)||alert(g[n])},0)}},r.on(N,e._getClipboardDataFromPasteBin,e),T&&(r.on("paste",e._iePaste,e),n.on("keydown",e._onKeyDown,e),n.on("contextmenu",function(){e._isPreventBeforePaste=1,setTimeout(function(){e._isPreventBeforePaste=0},0)})),t.addCommand("copy",new a("copy")),t.addCommand("cut",new a("cut")),t.addCommand("paste",new a("paste"))},_onKeyDown:function(e){var t=this,n=t.editor;n.get("mode")===c.Mode.WYSIWYG_MODE&&(e.ctrlKey&&86===e.keyCode||e.shiftKey&&45===e.keyCode)&&t._preventPasteEvent()},_stateFromNamedCommand:function(e){var t,n=this,r=n.editor;if("paste"===e){n._isPreventBeforePaste=1;try{t=r.get("document")[0].queryCommandEnabled(e)}catch(o){}n._isPreventBeforePaste=0}else{var a=r.getSelection(),i=a&&a.getRanges();t=i&&!(1===i.length&&i[0].collapsed)}return t},_preventPasteEvent:function(){var e=this;e._preventPasteTimer&&clearTimeout(e._preventPasteTimer),e._isPreventPaste=1,e._preventPasteTimer=setTimeout(function(){e._isPreventPaste=0},70)},_iePaste:function(e){var t=this,n=t.editor;t._isPreventPaste||(e.preventDefault(),n.execCommand("paste"))},_getClipboardDataFromPasteBin:function(){if(!this._isPreventBeforePaste){console.debug(N+":  paste event happen");var t=this,n=t.editor,r=n.get("document")[0];if(r.getElementById("ke-paste-bin"))return console.debug(N+": trigger more than once ..."),void 0;var o=n.getSelection(),a=new u(r),i=m(p.webkit?"<body></body>":"<div></div>",r);i.attr("id","ke-paste-bin"),p.webkit&&i[0].appendChild(r.createTextNode("â")),r.body.appendChild(i[0]),i.css({position:"absolute",top:o.getStartElement().offset().top+"px",width:"1px",height:"1px",overflow:"hidden"}),i.css("left","-1000px");var d=o.createBookmarks();a.setStartAt(i,h.POSITION_AFTER_START),a.setEndAt(i,h.POSITION_BEFORE_END),a.select(!0),setTimeout(function(){var t,r=i;i=p.webkit&&(t=i.first())&&t.hasClass("Apple-style-span")?t:i,o.selectBookmarks(d);var a=i.html();if(r.remove(),a=s(a)){console.debug("paste "+a);var l=n.fire("paste",{html:a});l!==!1&&(void 0!==l&&(a=l),/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument)/.test(a)?e("editor/plugin/word-filter",function(e){n.insertHtml(e.toDataFormat(a,n))}):n.insertHtml(a))}},0)}}});var y={copy:"å¤å¶",paste:"ç²è´´",cut:"åªå"};return t.init=function(e){var t;e.docReady(function(){t=new r(e)});var n={copy:1,cut:1,paste:1},o=["copy","cut","paste"];e.on("contextmenu",function(r){var a,i=r.contextmenu;if(!i.__copyFix){for(i.__copyFix=1,a=0;a<o.length;a++)i.addChild({content:y[o[a]],value:o[a]});i.on("click",function(t){var r=t.target.get("value");n[r]&&(i.hide(),setTimeout(function(){e.execCommand("save"),e.execCommand(r),setTimeout(function(){e.execCommand("save")},10)},30))})}var s=i.get("children");for(a=s.length-1;a>=0;a--){var d,l=s[a];d=l.get?l.get("value"):l.value;var c;n[d]&&(c=!t._stateFromNamedCommand(d),l.set?l.set("disabled",c):l.disabled=c)}})},t}(),g=function(t){function n(e,t){var n=e.get("textarea"),r=e.get("toolBarEl"),o=e.get("statusBarEl");t=parseInt(t,10),t-=(r&&r.outerHeight()||0)+(o&&o.outerHeight()||0),n.parent().css(P,t),n.css(P,t)}function r(e,t){var n=e.body;M(function(){e.designMode="on",setTimeout(function t(){e.designMode="off",n.focus(),t.retry||(t.retry=x)},50)},function(){e.designMode="off",n.setAttribute("contentEditable",!1),n.setAttribute("contentEditable",!0),t||r(e,1)})}function o(e){var t=e.get("textarea")[0],n=e.get("window"),o=e.get("document"),a=o[0];if(w.webkit&&(o.on("click",function(e){var t=E(e.target);v.inArray(t.nodeName(),["input","select"])&&e.preventDefault()}),o.on("mouseup",function(e){var t=E(e.target);v.inArray(t.nodeName(),["input","textarea"])&&e.preventDefault()})),w.gecko||w.ie){var i;i=E('<span tabindex="-1" style="position:absolute; left:-10000" role="presentation"></span>').insertAfter(t),i.on("focus",function(){e.focus()}),e.activateGecko=function(){w.gecko&&e.__iframeFocus&&i[0].focus()},e.on("destroy",function(){i.detach(),i.remove()})}if(n.on("focus",function(){w.gecko&&r(a,L),e.notifySelectionChange()}),w.gecko&&o.on("mousedown",function(){e.__iframeFocus||r(a,L)}),A&&(o.on("keydown",function(t){var n=t.keyCode;if(n in{8:1,46:1}){var r=e.getSelection(),o=r.getSelectedElement();if(o){e.execCommand("save");var a=r.getRanges()[0].createBookmark();o.remove(),r.selectBookmarks([a]),e.execCommand("save"),t.preventDefault()}}}),"CSS1Compat"===a.compatMode)){var s={33:1,34:1};o.on("keydown",function(t){t.keyCode in s&&setTimeout(function(){e.getSelection().scrollIntoView()},0)})}w.webkit&&o.on("mousedown",function(t){var n=E(t.target);v.inArray(n.nodeName(),["img","hr","input","textarea","select"])&&e.getSelection().selectElement(n)}),w.gecko&&o.on("dragstart",function(e){var t=E(e.target);"img"===t.nodeName()&&/ke_/.test(t[0].className)&&e.preventDefault()}),y.add(e)}function s(t,n,r,o){var a,i="",s=e.toUrl("./editor/assets/iframe.css");for(r=r.concat([]),r.unshift(s),a=0;a<r.length;a++)i+=v.substitute('<link href="{href}" rel="stylesheet" />',{href:r[a]});return N({doctype:8===w.ieMode?'<meta http-equiv="X-UA-Compatible" content="IE=7" />':"",title:"{title}",links:i,style:"<style>"+n+"</style>",data:o||"",script:t?'<script id="ke_active_script">'+(E(window).isCustomDomain()?'document.domain="'+document.domain+'";':"")+"parent."+V+'._initIframe("'+t+'");</script>':""})}function u(e,t){function n(){r=d.document,e.setInternal("document",E(r)),e.setInternal("window",E(d)),o.detach(),r.open("text/html","replace"),r.write(a),r.close()}var r,o=e.get("iframe"),a=s(e.get("id"),e.get("customStyle"),e.get("customLink"),t),i=o[0],d=i.contentWindow;o.__loaded=1;try{r=d.document}catch(l){if(i.src=i.src,7>A)return setTimeout(n,10),void 0}n()}function f(e,t){var n=E(window).getEmptyIframeSrc()||"";n&&(n=' src="'+n+'" ');var r=E(v.substitute(F,{iframeSrc:n,prefixCls:e.get("prefixCls")})),o=e.get("textarea");o.hasAttr("tabindex")&&r.attr("tabindex",w.webkit?-1:o.attr("tabindex")),o.parent().prepend(r),e.set("iframe",r),e.__docReady=0,w.gecko&&!r.__loaded?r.on("load",function(){u(e,t)},e):u(e,t)}function p(e){if(e.get("iframe")){var t=e.get("iframe"),n=e.get("window"),r=e.get("document"),o=r[0],a=E(o.documentElement),i=E(o.body);v.each([r,a,i,n],function(e){e.detach()}),t.remove()}}var v=C,E=b,N=i,h=d,g=l,y=c,O=_,k=m,I=a,R=T;t=h;var x=!0,L=!1,D=null,w=S,A=w.ieMode<11,B=E.Dom.NodeType,P="height",M=g.tryThese,F='<iframe class="{prefixCls}editor-iframe" frameborder="0"  title="kissy-editor"  allowTransparency="true"  {iframeSrc} ></iframe>',X=/^(?:<(p)>)?(?:(?:&nbsp;)|\s|<br[^>]*>)*(?:<\/\1>)?$/i;h.version="1.0.1",h.Mode={SOURCE_MODE:0,WYSIWYG_MODE:1};var H=1,$=v.buffer(function(){this.execCommand("save")},50),V="Editor"+ +new Date;return window[V]=h,h.addMembers({initializer:function(){var e=this;e.__commands={},e.__controls={},y.register(e)},renderUI:function(){var e=this;O.init(e),k.init(e),I.init(e),R.init(e)},bindUI:function(){function e(){if(n.detach("docReady",e),n.get("focused"))n.focus();else{var t=n.getSelection();t&&t.removeAllRanges()}}var t,n=this,r=n.get("prefixCls"),o=n.get("textarea");n.get("attachForm")&&(t=o[0].form)&&(t=E(t))&&t.on("submit",n.sync,n),n.on("docReady",e),n.on("blur",function(){n.$el.removeClass(r+"editor-focused")}),n.on("focus",function(){n.$el.addClass(r+"editor-focused")})},syncUI:function(){n(this,this.get("height"))},sync:function(){var e=this;e.get("textarea").val(e.getData())},getControl:function(e){return this.__controls[e]},getControls:function(){return this.__controls},addControl:function(e,t){this.__controls[e]=t},showDialog:function(e,t){e+="/dialog";var n=this,r=n.__controls[e];r.show(t),n.fire("dialogShow",{dialog:r.dialog,pluginDialog:r,dialogName:e})},addCommand:function(e,t){this.__commands[e]=t},hasCommand:function(e){return this.__commands[e]},execCommand:function(e){var t=this,n=t.__commands[e],r=v.makeArray(arguments);return r.shift(),r.unshift(t),n?n.exec.apply(n,r):(console.error(e+": command not found"),void 0)},queryCommandValue:function(e){return this.execCommand(g.getQueryCmd(e))},setData:function(e){var t,n=this,r=e;return n.get("mode")!==H?(n.get("textarea").val(e),void 0):((t=n.htmlDataProcessor)&&(r=t.toDataFormat(e)),p(n),f(n,r),void 0)},getData:function(e,t){var n,r=this,o=r.htmlDataProcessor;return void 0===t&&(t=r.get("mode")),n=t===H&&r.isDocReady()?r.get("document")[0].body.innerHTML:o.toDataFormat(r.get("textarea").val()),n=e?o.toHtml(n):o.toServer(n),n=v.trim(n),X.test(n)&&(n=""),n},getFormatData:function(e){return this.getData(1,e)},getDocHtml:function(){var e=this;return s(0,e.get("customStyle"),e.get("customLink"),e.getFormatData())},getSelection:function(){return h.Selection.getSelection(this.get("document")[0])},getSelectedHtml:function(){var e,t=this,n=t.getSelection().getRanges()[0],r="";return n&&(e=n.cloneContents(),r=t.get("document")[0].createElement("div"),r.appendChild(e),r=r.innerHTML),r},focus:function(){var e=this,t=e.get("window");if(t){var n=e.get("document")[0];t=t[0],w.ie||t&&t.parent&&t.parent.focus(),t&&t.focus();try{n.body.focus()}catch(r){}e.notifySelectionChange()}},blur:function(){var e=this,t=e.get("window")[0];t.blur(),e.get("document")[0].body.blur()},addCustomStyle:function(e,t){var n=this,r=n.get("window"),o=n.get("customStyle")||"";o+="\n"+e,n.set("customStyle",o),r&&r.addStyleSheet(e,t)},removeCustomStyle:function(e){this.get("document").on("#"+e).remove()},addCustomLink:function(e){var t=this,n=t.get("customLink"),r=t.get("document")[0];n.push(e),t.set("customLink",n);var o=r.createElement("link");o.rel="stylesheet",r.getElementsByTagName("head")[0].appendChild(o),o.href=e},removeCustomLink:function(e){var t=this,n=t.get("document"),r=n.all("link");r.each(function(t){t.attr("href")===e&&t.remove()});var o=t.get("customLink"),a=v.indexOf(e,o);-1!==a&&o.splice(a,1)},docReady:function(e){var t=this;t.on("docReady",e),t.__docReady&&e.call(t)},isDocReady:function(){return this.__docReady},checkSelectionChange:function(){var e=this;e.__checkSelectionChangeId&&clearTimeout(e.__checkSelectionChangeId),e.__checkSelectionChangeId=setTimeout(function(){var t=e.getSelection();if(t&&!t.isInvalid){var n=t.getStartElement(),r=new h.ElementPath(n);e.__previousPath&&e.__previousPath.compare(r)||(e.__previousPath=r,e.fire("selectionChange",{selection:t,path:r,element:n}))}},100)},notifySelectionChange:function(){var e=this;e.__previousPath=D,e.checkSelectionChange()},insertElement:function(e){var t=this;if(t.get("mode")!==H)return void 0;t.focus();var n,r,o,a,i,s,d,l=e.nodeName(),c=h.XHTML_DTD,u=c.$block[l],f=h.RangeType,m=t.getSelection(),p=m&&m.getRanges();if(!p||0===p.length)return void 0;for(t.execCommand("save"),a=p.length-1;a>=0;a--)r=p[a],n=!a&&e||e.clone(x),r.insertNodeByDtd(n),d||(d=n);return d?(r.moveToPosition(d,f.POSITION_AFTER_END),u&&(o=h.Walker.whitespaces(!0),i=d.next(o,1),s=i&&i[0].nodeType===B.ELEMENT_NODE&&i.nodeName(),s&&c.$block[s]&&c[s]["#text"]&&r.moveToElementEditablePosition(i)),m.selectRanges([r]),t.focus(),n&&1===n[0].nodeType&&n.scrollIntoView(void 0,{alignWithTop:!1,allowHorizontalScroll:!0,onlyScrollIfNeeded:!0}),$.call(t),n):void 0},insertHtml:function(e,t){var n,r=this,o=r.get("document")[0];if(r.get("mode")===H){(n=r.htmlDataProcessor)&&(e=n.toDataFormat(e,t)),r.focus(),r.execCommand("save");var a=o.selection;if(a){"Control"===a.type&&a.clear();try{a.createRange().pasteHTML(e)}catch(i){console.error("insertHtml error in ie")}}else{var s=r.get("iframe")[0].contentWindow.getSelection(),d=s.getRangeAt(0);d.deleteContents();var l=o.createElement("div");l.innerHTML=e;for(var c,u,f=o.createDocumentFragment();c=l.firstChild;)u=f.appendChild(c);d.insertNode(f),u&&(d=d.cloneRange(),d.setStartAfter(u),d.collapse(!0),s.removeAllRanges(),s.addRange(d))}setTimeout(function(){r.getSelection().scrollIntoView()},50),$.call(r)}},_onSetHeight:function(e){n(this,e)},_onSetMode:function(e){var t=this,n=t.get("iframe"),r=t.get("textarea");e===H?(t.setData(r.val()),r.hide(),t.fire("wysiwygMode")):(n&&(r.val(t.getFormatData(H)),n.hide()),r.show(),t.fire("sourceMode"))},_onSetFocused:function(e){var t=this;e&&t.__docReady&&t.focus()},destructor:function(){var e,t=this,n=t.get("textarea"),r=t.get("document");if(t.get("attachForm")&&(e=n[0].form)&&(e=E(e))&&e.detach("submit",t.sync,t),r){var o=E(r[0].body),a=E(r[0].documentElement),i=t.get("window");y.remove(t),r.detach(),a.detach(),o.detach(),i.detach()}v.each(t.__controls,function(e){e.destroy&&e.destroy()}),t.__commands={},t.__controls={}}}),h.decorate=function(e,t){t=t||{},e=E(e);var n=t.textareaAttrs=t.textareaAttrs||{},r=e.style("width"),o=e.style("height"),a=e.attr("name");r&&(t.width=t.width||r),o&&(t.height=t.height||o),a&&(n.name=a),t.data=t.data||e.val(),t.elBefore=e;var i=new h(t).render();return e.remove(),i},h._initIframe=function(e){var t=y.getInstance(e),n=t.get("document"),a=n[0],i=n.one("#ke_active_script");i.remove(),o(t);var s=a.body,d=E(s);if(A?(s.hideFocus=x,s.disabled=x,s.contentEditable=x,s.removeAttribute("disabled")):setTimeout(function(){w.gecko?s.contentEditable=x:w.webkit?s.parentNode.contentEditable=x:a.designMode="on"},0),w.gecko){var l=a.documentElement;E(l).on("mousedown",function(e){var n=e.target;n===l&&(w.gecko&&r(a,L),t.activateGecko())})}setTimeout(function(){A&&setTimeout(function(){a&&(s.runtimeStyle.marginBottom="0px",s.runtimeStyle.marginBottom="")},1e3)},0),setTimeout(function(){t.__docReady=1,t.fire("docReady");var e=t.get("disableObjectResizing"),n=t.get("disableInlineTableEditing");if(e||n)try{a.execCommand("enableObjectResizing",L,!e),a.execCommand("enableInlineTableEditing",L,!n)}catch(r){d.on(A?"resizestart":"resize",function(t){var r=E(t.target);(e||"table"===r.nodeName()&&n)&&t.preventDefault()})}},10)},t}(),n.exports=g});